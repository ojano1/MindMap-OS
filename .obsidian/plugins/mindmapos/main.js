/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var _=Object.defineProperty;var Ft=Object.getOwnPropertyDescriptor;var Et=Object.getOwnPropertyNames;var Pt=Object.prototype.hasOwnProperty;var Dt=(t,e)=>{for(var n in e)_(t,n,{get:e[n],enumerable:!0})},$t=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Et(e))!Pt.call(t,r)&&r!==n&&_(t,r,{get:()=>e[r],enumerable:!(a=Ft(e,r))||a.enumerable});return t};var Lt=t=>$t(_({},"__esModule",{value:!0}),t);var Ze={};Dt(Ze,{default:()=>O});module.exports=Lt(Ze);var A=require("obsidian");var q=require("obsidian");var E=require("obsidian");function Ct(t,e,n){let a=t.metadataCache.getFileCache(e);if(!a?.headings)return null;let r=d=>d.trim().toLowerCase(),o=r(n),s=a.headings.sort((d,u)=>d.position.start.line-u.position.start.line),l=s.findIndex(d=>r(d.heading)===o);if(l===-1)return null;let i=s[l].position.end.line+1,c=l<s.length-1?s[l+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:i,endLine:c}}async function z(t,e,n,a){let r=Ct(t,e,n);if(!r)return!1;let s=(await t.vault.read(e)).split(`
`),l=Math.min(r.startLine,s.length-1),i=Math.min(r.endLine,s.length-1),c=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let d=l;d<=i;d++){let u=s[d].match(c);if(!u)continue;let p=`- [${u[1]==="x"||u[1]==="X"?"x":" "}] ${a}`;return s[d]!==p&&(s[d]=p,await t.vault.modify(e,s.join(`
`))),!0}return!1}function b(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function Yt(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function jt(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function Ht(t=new Date){return t.getFullYear()}function Ot(t=new Date){return Math.floor(t.getMonth()/3)+1}function _t(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+n)/864e5+1)/7)}function I(t,e,n=new Date){let a=b(n),r=t;return r=r.replace(/{{\s*title\s*}}/gi,e),r=r.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,o=>a),r=r.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),r=r.replace(/{{\s*weekday\s*}}/gi,Yt(n)),r=r.replace(/{{\s*monthShort\s*}}/gi,jt(n)),r=r.replace(/{{\s*year\s*}}/gi,String(Ht(n))),r=r.replace(/{{\s*isoWeek\s*}}/gi,String(_t(n))),r=r.replace(/{{\s*quarter\s*}}/gi,String(Ot(n))),r}function It(t,e){let n=(0,E.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function $(t,e){let n=(0,E.normalizePath)(e).split("/"),a="";for(let r of n)a=a?`${a}/${r}`:r,t.vault.getAbstractFileByPath(a)||await t.vault.createFolder(a)}async function k(t,e,n){let a=(0,E.normalizePath)(e);if(!It(t,a)){let o=a.split("/").slice(0,-1).join("/");o&&await $(t,o),await t.vault.create(a,n)}}var L=require("obsidian");var T="03 SaveBox/Templates",R={area:`${T}/Area Template.md`,wish:`${T}/Wish Template.md`,goal:`${T}/Goal Template.md`,project:`${T}/Project Template.md`,task:`${T}/Task Template.md`,habit:`${T}/Habit Template.md`,note:`${T}/Note Template.md`,daily:`${T}/Daily Template.md`,weekly:`${T}/Weekly Template.md`,monthly:`${T}/Monthly Template.md`,quarterly:`${T}/Quarterly Template.md`,yearly:`${T}/Yearly Template.md`},B={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function C(t,e,n,a=new Date){let r=(0,L.normalizePath)(R[e]),o=t.vault.getAbstractFileByPath(r);if(o instanceof L.TFile){console.log(`[MMOS] Using VAULT template for ${e}: ${r}`);let s=await t.vault.read(o);return I(s,n,a)}return console.log(`[MMOS] Using FALLBACK template for ${e}`),I(B[e],n,a)}async function U(t,e){let{kind:n,title:a}=e,r=e.path??Rt(n,a),o=r.substring(0,r.lastIndexOf("/"));o&&await $(t,o);let s=await C(t,n,a,new Date),l=await t.vault.create(r,s);return await t.fileManager.processFrontMatter(l,i=>{i.created??(i.created=b(new Date)),n==="task"?(i.status??(i.status="Active"),i.impact??(i.impact="Med"),i.slot??(i.slot="Morning"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(i.status??(i.status="Active"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):(n==="area"||n==="note")&&(i.status??(i.status="Active"))}),l}async function X(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of e)await $(t,n);await k(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await k(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await k(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await k(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await k(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,a]of Object.entries(R))await k(t,a,B[n]);await k(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${b(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await k(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${b(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await k(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${b(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await k(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${b(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await k(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new q.Notice("\u2705 MindMap OS: starter structure updated.")}function Rt(t,e){let n=Wt(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${Bt(t)}${n}.md`}}function Bt(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";default:return""}}function Wt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var P=require("obsidian");var Gt=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],Nt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function Kt(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function zt(t,e){let a=new RegExp(`^#{1,6}\\s+${Kt(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,o=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${o}}\\s+`,"gim");s.lastIndex=r;let l=s.exec(t);return{start:r,end:l?l.index:t.length}}function qt(t,e){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=t.slice(e.start,e.end);n.lastIndex=0;let r=n.exec(a);if(!r)return null;let o=e.start+r.index,s=o+r[0].length,l=/\[(x|X)\]/.test(r[0]);return{absStart:o,absEnd:s,line:r[0],checked:l}}async function Ut(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(r=>setTimeout(r,40))}}async function Xt(t,e,n,a){await Ut(t,e);let r=await t.vault.read(e),o=zt(r,n);if(!o)return!1;let s=qt(r,o);if(!s)return!1;let i=`- [${/\[(x|X)\]/.test(s.line)?"x":" "}] ${a}`;if(s.line.trimEnd()===i)return!0;let c=r.slice(0,s.absStart)+i+r.slice(s.absEnd);return c!==r&&await t.vault.modify(e,c),!0}function Vt(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}function Qt(t){return t instanceof P.TFile&&t.extension.toLowerCase()==="md"}function Zt(t){let e=t.match(/^(\w+)\s*(?:[-–]\s*|\s+)(.+)$/i);if(!e)return null;let n=e[1].toLowerCase();if(!Gt.includes(n))return null;let a=e[2].trim();return{kind:n,title:a}}function Jt(t,e){let n=te(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${Nt[t]}${n}.md`}}function te(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function ee(t,e,n){await t.fileManager.processFrontMatter(e,a=>{a.created??(a.created=b(new Date)),n==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):n==="goal"||n==="project"||n==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):(n==="area"||n==="note")&&(a.status??(a.status="Active"))})}function V(t){t.vault.on("create",async e=>{try{if(!Qt(e)||(await t.vault.read(e)).trim().length>0)return;let a=e.basename,r=Zt(a);if(!r)return;let{kind:o,title:s}=r,l=await C(t,o,s,new Date);await t.vault.modify(e,l),await ee(t,e,o);let i=(0,P.normalizePath)(Jt(o,s));if(i!==e.path&&await t.fileManager.renameFile(e,i),o==="task"||o==="project"||o==="goal"){let c=t.vault.getAbstractFileByPath(i),d=c instanceof P.TFile?c:e,u=Vt(o),h=d.basename;await Xt(t,d,u,h)}console.log(`[MMOS] wikilink routed \u2192 ${o} | ${s}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var Z=require("obsidian");function ne(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ae(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function J(t,e){let a=new RegExp(`^#{1,6}\\s+${ne(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,o=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${o}}\\s+`,"gim");s.lastIndex=r;let l=s.exec(t);return{start:r,end:l?l.index:t.length}}var Q=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function tt(t,e){let n=t.slice(e.start,e.end);Q.lastIndex=0;let a=Q.exec(n);if(!a)return null;let r=e.start+a.index,o=r+a[0].length,s=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:o,line:a[0],checked:s}}function et(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var re=2e3;function ie(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function oe(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function se(t){return/<%[\s\S]*?%>/.test(t)}function ce(t){let e=t?.stat?.ctime??0;return Date.now()-e<re}function nt(t,e){let n=new Set,a=t.vault.on("modify",c=>{n.has(c.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),r=c=>{let d=t.workspace.getActiveViewOfType(Z.MarkdownView),h=!!d&&d.file?.path===c.path&&d?.getMode()!=="preview";return{editor:d?.editor,inEdit:h}},o=async(c,d)=>{n.add(c.path);try{await t.fileManager.processFrontMatter(c,u=>{for(let h of Object.keys(d))u[h]=d[h]})}finally{n.delete(c.path)}},s=async(c,d,u,h,p)=>{let{editor:g,inEdit:m}=r(c);n.add(c.path);try{if(m&&g){let f=g.offsetToPos(u),y=g.offsetToPos(h);await new Promise(requestAnimationFrame),g.replaceRange(p,f,y)}else{let f=d.slice(0,u)+p+d.slice(h);f!==d&&await t.vault.modify(c,f)}}finally{n.delete(c.path)}},i=ae(async()=>{let c=t.workspace.getActiveFile();if(!c||e?.(c)||ie(c.path))return;let u=(t.metadataCache.getFileCache(c)??{}).frontmatter??{};if(oe(u))return;let{editor:h,inEdit:p}=r(c),g=p&&h?h.getValue():await t.vault.read(c);if(!g||se(g)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(g)||ce(c)||n.has(c.path))return;let f=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let y of f){let w=J(g,y.heading);if(!w)continue;let v=tt(g,w);if(!v)continue;let x=typeof u.done=="boolean"?u.done:null,S=typeof u[y.flag]=="boolean"?u[y.flag]:null,F=v.checked;if(S===null){await o(c,{done:!!F,[y.flag]:!!F});return}let At=x!==null&&x!==S;if(F!==S){await o(c,{done:!!F,[y.flag]:!!F});return}if(At){let St=et(v.line,!!x);await s(c,g,v.absStart,v.absEnd,St),await o(c,{[y.flag]:!!x});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function at(t,e){let a=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},r=!(typeof a.done=="boolean"&&a.done);await t.fileManager.processFrontMatter(e,l=>{l.done=r});let o=await t.vault.read(e),s=["My Task","My Project","My Goal"];for(let l of s){let i=J(o,l);if(!i)continue;let c=tt(o,i);if(!c)continue;let d=et(c.line,r),u=o.slice(0,c.absStart)+d+o.slice(c.absEnd);u!==o&&await t.vault.modify(e,u);break}}var it=require("obsidian");function le(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function de(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function ue(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function me(t){return/<%[\s\S]*?%>/.test(t)}function ge(t,e=1500){let n=t?.stat?.ctime??0;return Date.now()-n<e}function he(t,e,n,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function pe(t,e){let n=e.map(le).join("|"),r=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(t);if(!r)return null;let o=r.index+r[0].length,s=(r[0].match(/^#+/)||["#"])[0].length,l=new RegExp(`^#{1,${s}}\\s+`,"gim");l.lastIndex=o;let i=l.exec(t);return{start:o,end:i?i.index:t.length}}var rt=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function fe(t,e){let n=t.slice(e.start,e.end);rt.lastIndex=0;let a=rt.exec(n);if(!a)return null;let r=e.start+a.index,o=r+a[0].length,s=/\[(x|X)\]/.test(a[0]);return{absStart:r,absEnd:o,line:a[0],checked:s}}function ye(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}function ot(t,e){let n=new Set,a=i=>{let c=t.workspace.getActiveViewOfType(it.MarkdownView),u=!!c&&c.file?.path===i.path&&c?.getMode()!=="preview";return{editor:c?.editor,inEdit:u}},r=async(i,c)=>{n.add(i.path);try{await t.fileManager.processFrontMatter(i,d=>{for(let u of Object.keys(c))d[u]=c[u]})}finally{n.delete(i.path)}},o=async(i,c,d,u,h)=>{let{editor:p,inEdit:g}=a(i);n.add(i.path);try{if(g&&p){let m=p.offsetToPos(d),f=p.offsetToPos(u);await new Promise(requestAnimationFrame),p.replaceRange(h,m,f)}else{let m=c.slice(0,d)+h+c.slice(u);m!==c&&await t.vault.modify(i,m)}}finally{n.delete(i.path)}},l=de(async()=>{let i=t.workspace.getActiveFile();if(!i||e?.(i)||ue(i.path)||ge(i)||n.has(i.path))return;let d=(t.metadataCache.getFileCache(i)??{}).frontmatter??{},{editor:u,inEdit:h}=a(i),p=h&&u?u.getValue():await t.vault.read(i);if(!p||me(p)||!he(i.path,i.basename,p,d))return;let g=pe(p,["\u270D\uFE0F Log","Log"]);if(!g)return;let m=fe(p,g),f=typeof d.done=="boolean"?d.done:null,y=typeof d._habit_sync_state=="boolean"?d._habit_sync_state:null;if(!m&&f===null)return;if(y===null){m?await r(i,{done:!!m.checked,_habit_sync_state:!!m.checked}):f!==null&&await r(i,{_habit_sync_state:!!f});return}let w=m?m.checked:null,v=f!==null&&f!==y;if(w!==null&&w!==y){await r(i,{done:!!w,_habit_sync_state:!!w});return}if(v&&m){let S=ye(m.line,!!f);await o(i,p,m.absStart,m.absEnd,S),await r(i,{_habit_sync_state:!!f});return}},150);t.workspace.on("file-open",()=>l()),t.workspace.on("active-leaf-change",()=>l()),t.workspace.on("layout-change",()=>l()),t.workspace.on("editor-change",()=>l()),t.metadataCache.on("changed",()=>l()),t.metadataCache.on("resolved",()=>l()),t.vault.on("modify",()=>l()),t.vault.on("rename",()=>l()),t.vault.on("create",()=>l())}var D=require("obsidian");var lt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - "};function we(t,e){return e||{app:t,withInitGuard:async(n,a)=>{await a()}}}function dt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function ut(t){return t.trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function be(t,e){let n=dt(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${lt[t]}${n}.md`}}function W(t,e){let n=t.vault.getAbstractFileByPath((0,D.normalizePath)(e));return n instanceof D.TFile?n:null}function xe(t){let e=t.trim().toLowerCase(),n=new Date;return e==="today"?b(n):e==="tomorrow"?(n.setDate(n.getDate()+1),b(n)):e==="yesterday"?(n.setDate(n.getDate()-1),b(n)):/^\d{4}-\d{2}-\d{2}$/.test(t)?t:b(n)}async function st(t,e,n){if(!["task","project","goal","area","wish","habit"].includes(n))return e;let a=lt[n],r=e.path.startsWith("03 SaveBox/Active/"),o=e.basename.startsWith(a);if(!r||o)return e;let s=e.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),l=ut(s||"Untitled"),i=(0,D.normalizePath)(`03 SaveBox/Active/${a}${dt(l)}.md`);if(i===e.path)return e;let c=W(t,i);return c||(await t.fileManager.renameFile(e,i),W(t,i)??e)}async function Y(t,e,n,a){let r=we(t,a),o=n;e==="daily"?o=xe(n):["task","project","goal","area","wish","habit"].includes(e)&&(o=ut(n));let s=be(e,o),l=W(t,s);if(l){let d=await st(t,l,e);return await t.workspace.getLeaf(!1).openFile(d),(e==="task"||e==="project"||e==="goal")&&await ct(r,d,e),d}let i=await U(t,{kind:e,title:o}),c=await st(t,i,e);return await t.workspace.getLeaf(!1).openFile(c),(e==="task"||e==="project"||e==="goal")&&await ct(r,c,e),c}async function ke(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(r=>setTimeout(r,40))}}function Te(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}async function ct(t,e,n){await t.withInitGuard(e,async()=>{await ke(t.app,e);let a=e.basename,r=Te(n);console.log("[MindMapOS] finalizeNewNote",n,e.basename),await z(t.app,e,r,a)})}var mt=(t,e,n)=>Y(t,"task",e,n),gt=(t,e,n)=>Y(t,"project",e,n),ht=(t,e,n)=>Y(t,"goal",e,n);var pt=(t,e="today")=>Y(t,"daily",e);var Me=window.moment,G=new Set,ve={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},N={};for(let[t,e]of Object.entries(ve))for(let n of e)N[n.toLowerCase()]=t;var Ae=Object.keys(N).sort((t,e)=>e.length-t.length).join("|"),Se=new RegExp(`\\b(?:${Ae})\\b`,"gi");function Fe(t){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(t);if(!n)return null;let a=n[0],r=n.index+a.length;return t[r]==="\r"&&t[r+1]===`
`?r+2:t[r]===`
`?r+1:r}function Ee(t,e){let n=Fe(t);if(n===null)return t.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${e}
`;let a=t.slice(0,n),o=t.slice(n).replace(/^\r?\n{0,}/,""),s=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+s+e+`
`+o}function ft(t,e){let n=t.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(t.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t.basename))return!0;if(e){let a=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function Pe(t){let e=t.match(Se);return e?[...new Set(e.map(n=>N[n.toLowerCase()]).filter(Boolean))]:[]}function De(t){let e=Pe(t);if(e.length===0)return!0;let n=Me().format("dddd");return e.includes(n)}function $e(t){let e=t.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return e?e[1].trim():t.trim()}async function yt(t,e,n){let a=window.moment().format("YYYY-MM-DD"),r=`^${a}`;if(n.includes(r))return!1;let s=`- [ ] \u{1F504}Habit - ${$e(e.basename)} ${a} ${r}`,l=Ee(n,s);return await t.vault.modify(e,l),!0}async function j(t,e){let n=e.path;if(!G.has(n)){G.add(n);try{if(!ft(e))return;if(!De(e.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:e.path});return}let a=await t.vault.read(e);if(!ft(e,a))return;await yt(t,e,a)}finally{setTimeout(()=>G.delete(n),120)}}}async function wt(t,e){let n=await t.vault.read(e);await yt(t,e,n)}var Le=window.moment,Ce="03 SaveBox/Active",Ye=/(^| )Habit -|^🔁Habit -/i,je={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},K={};for(let[t,e]of Object.entries(je))for(let n of e)K[n.toLowerCase()]=t;var He=Object.keys(K).sort((t,e)=>e.length-t.length).join("|"),Oe=new RegExp(`\\b(?:${He})\\b`,"gi");function _e(t){let e=t.match(Oe);return e?[...new Set(e.map(n=>K[n.toLowerCase()]).filter(Boolean))]:[]}function Ie(t){let e=Le().format("dddd"),n=_e(t);return{ok:n.length>0&&n.includes(e),todayName:e}}async function bt(t,e=Ce){let n=t.vault.getMarkdownFiles().filter(a=>a.path.startsWith(e+"/")).filter(a=>Ye.test(a.basename));for(let a of n){let{ok:r}=Ie(a.basename);if(r)try{await j(t,a)}catch{}}}var H=require("obsidian"),M=window.moment,Tt=t=>M(t).format("YYYY-MM-DD");function xt(t){let e=M(t+"-01","YYYY-MM-DD").startOf("month"),n=e.clone().endOf("month");return{start:e,end:n}}function Re(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Be(t,e){let a=new RegExp(`^#{1,6}\\s+${Re(e)}\\s*$`,"gim").exec(t);if(!a)return null;let r=a.index+a[0].length,o=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${o}}\\s+`,"gim");s.lastIndex=r;let l=s.exec(t);return{start:r,end:l?l.index:t.length}}function We(t){t=String(t).trim();let e=t.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/);return e||(e=t.match(/due\((\d{4}-\d{2}-\d{2})\)/i),e)||(e=t.match(/due::\s*(\d{4}-\d{2}-\d{2})/i),e)||(e=t.match(/📅\s*(\d{4}-\d{2}-\d{2})/),e)?e[1]:null}async function Ge(t,e){let n=t.vault.getAbstractFileByPath(e.sourcePath);return n instanceof H.TFile?t.vault.read(n):""}function Ne(t){let e=Be(t,"\u270D\uFE0F Log")||{start:0,end:t.length},n=t.slice(e.start,e.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,r=[],o;for(;o=a.exec(n);){let s=o[1].toLowerCase()==="x",l=o[2],i=We(l);i&&r.push({date:i,done:s})}return r}function Ke(t){let e=new Map;for(let n of t)e.set(n.date,e.get(n.date)||!1||n.done);return e}function ze(t){let e={};for(let[a,r]of t){let o=M(a).format("YYYY-MM");(e[o]||(e[o]=[])).push({date:a,done:r})}return Object.keys(e).sort().slice(-3).reverse().map(a=>{let r=e[a],o=r.length?Math.round(r.filter(s=>s.done).length/r.length*100):0;return{label:M(a,"YYYY-MM").format("MMM"),pct:o}})}function qe(t,e=90){let n=0,a=M();for(let r=0;r<e;r++){let o=Tt(a);if(t.get(o))n++;else break;a.subtract(1,"day")}return n}function Ue(t,e,n){let a=t.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let r=a.createDiv({cls:"month-bars"});e.forEach(({label:o,pct:s},l)=>{let i=r.createDiv({cls:"month-row"});i.innerHTML=`
      <div class="month-label">${o}</div>
      <div class="bar-track">
        <div class="bar-fill ${l===0?"bar-orange":"bar-purple"}" style="width:${s}%;"></div>
      </div>
      <div class="pct-text">${s}<span class="pct-symbol">%</span></div>
    `})}function kt(t,e,n,a){let r=g=>M(g).format("YYYY-MM-DD"),o=n.clone().startOf("isoWeek"),s=a.clone().endOf("isoWeek"),l=[...e.keys()].sort(),i=null;for(let g=l.length-1;g>=0;g--){let m=l[g];if(!M(m).isAfter(a)){if(M(m).isBefore(n))break;if(e.get(m)){i=m;break}}}let c=t.createDiv({cls:"weekly-streak-wrap"}),d=c.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(g=>d.createDiv({cls:"head",text:g}));let u=c.createDiv({cls:"weekly-streak-grid"}),h=[],p=s.clone().endOf("isoWeek");for(;p.isSameOrAfter(o);){let g=p.clone().startOf("isoWeek");h.push({weekStart:g.clone(),weekEnd:p.clone()}),p.subtract(1,"week")}for(let g of h){let m=g.weekStart.clone();for(let f=0;f<7;f++){let y=r(m),w=m.isSameOrAfter(n)&&m.isSameOrBefore(a),v=w?!!e.get(y):!1,x=u.createDiv({cls:"weekly-streak-cell"});w||x.classList.add("pad"),v&&w&&(x.classList.add("hit"),y===i&&x.classList.add("latest-hit")),x.createDiv({cls:"num",text:w?m.format("D"):""}),x.createDiv({cls:"mmm",text:w?m.format("MMM"):""}),x.setAttr("title",w?`${m.format("ddd, DD MMM YYYY")} ${v?"\u2705 Done":"\u274C Missed"}`:""),m.add(1,"day")}}}function Xe(t,e,n){let a=t.createDiv({cls:"month-switch"});return e.forEach((r,o)=>{let s=a.createEl("button",{text:r.label,cls:"month-btn"});o===0&&s.classList.add("active"),s.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(l=>l.classList.remove("active")),s.classList.add("active"),n(r.key)})}),a}function Ve(t){let e=document.createElement("style");e.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label {
  width: 4ch;
  text-align: right;
  font-weight: 600;
  font-size: .95em;
  white-space: nowrap;
}
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn {
  font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer;
  background: var(--background-modifier-border); border: none;
}
.month-btn.active {
  background: var(--interactive-accent);
  color: white;
}
  
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden;
  background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border);
  display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,t.appendChild(e)}async function Mt(t,e,n){let a=await Ge(t,n),r=Ne(a);if(!r.length){let u=M(),h=u.clone().subtract(89,"days");for(;h.isSameOrBefore(u);)r.push({date:Tt(h),done:Math.random()<.75}),h.add(1,"day")}let o=Ke(r),s=ze(o),l=qe(o);Ve(e),Ue(e,s,l);let c=Array.from(new Set([...o.keys()].map(u=>M(u).format("YYYY-MM")))).sort().slice(-3).reverse().map(u=>({key:u,label:M(u,"YYYY-MM").format("MMM")})),d=c[0]?.key;if(Xe(e,c,u=>{d=u,e.querySelectorAll(".weekly-streak-wrap").forEach(g=>g.remove());let{start:h,end:p}=xt(u);kt(e,o,h,p)}),d){let{start:u,end:h}=xt(d);kt(e,o,u,h)}}function Qe(t,e,n){let a=(()=>{let o=null;return()=>{o&&window.clearTimeout(o),o=window.setTimeout(async()=>{o=null,e.empty(),await Mt(t.app,e,n)},120)}})();class r extends H.MarkdownRenderChild{onload(){this.registerEvent(t.app.vault.on("modify",s=>{s?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("changed",s=>{s?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("resolved",()=>a())),this.registerEvent(t.app.workspace.on("editor-change",()=>a()))}}n.addChild(new r(e))}function vt(t){t.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",async(e,n,a)=>{await Mt(t.app,n,a),Qe(t,n,a)})}var O=class extends A.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set}isInitializing(n){return this.initializingPaths.has(n.path)}async withInitGuard(n,a){this.initializingPaths.add(n.path);try{return await a()}finally{this.initializingPaths.delete(n.path)}}async onload(){console.log("MindMap OS loaded"),V(this.app),nt(this.app,r=>this.isInitializing(r)),ot(this.app,r=>this.isInitializing(r)),this.addCommand({id:"mmos-habits-run-autolog-today",name:"Habits: Ensure Today\u2019s Log Lines",callback:async()=>{await bt(this.app,"03 SaveBox/Active"),new A.Notice("Checked today's scheduled habits.")}});let n=async r=>{if(r)try{await j(this.app,r)}catch(o){console.error("[MindMapOS] autolog error",o)}},a=r=>{r&&(n(r),window.setTimeout(()=>n(r),150),window.setTimeout(()=>n(r),600))};this.app.workspace.onLayoutReady(()=>{let r=this.app.workspace.getActiveFile();window.setTimeout(()=>a(r),50)}),this.registerEvent(this.app.workspace.on("file-open",r=>a(r))),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{let r=this.app.workspace.getActiveFile();a(r)})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{let r=this.app.workspace.getActiveFile();a(r)})),this.addCommand({id:"mmos-create-starter-structure",name:"Create Starter Structure",callback:async()=>{await X(this.app),new A.Notice("Starter structure created.")}}),this.addCommand({id:"mmos-open-today",name:"Open Today",callback:async()=>{await pt(this.app,"today")}}),this.addCommand({id:"mmos-new-task",name:"New Task\u2026",callback:async()=>{await mt(this.app,"New Task")}}),this.addCommand({id:"mmos-new-project",name:"New Project\u2026",callback:async()=>{await gt(this.app,"New Project")}}),this.addCommand({id:"mmos-new-goal",name:"New Goal\u2026",callback:async()=>{await ht(this.app,"New Goal")}}),this.addCommand({id:"mmos-toggle-done",name:"Toggle Done (YAML \u2194 checkbox)",callback:async()=>{let r=this.app.workspace.getActiveFile();r?await at(this.app,r):new A.Notice("No active file to toggle.")}}),this.addCommand({id:"mmos-habit-force-today",name:"Habit: Add Today\u2019s Log (force)",callback:async()=>{let r=this.app.workspace.getActiveFile();if(!r)return new A.Notice("No active file.");await wt(this.app,r)}}),console.log("MindMap OS ready"),vt(this)}onunload(){console.log("MindMap OS unloaded")}};
