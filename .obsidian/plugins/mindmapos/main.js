/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var M=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var J=(t,e)=>{for(var n in e)M(t,n,{get:e[n],enumerable:!0})},Q=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of q(e))!X.call(t,o)&&o!==n&&M(t,o,{get:()=>e[o],enumerable:!(a=H(e,o))||a.enumerable});return t};var Z=t=>Q(M({},"__esModule",{value:!0}),t);var xt={};J(xt,{default:()=>x});module.exports=Z(xt);var h=require("obsidian");var d=require("obsidian");var T=require("obsidian");function b(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*60*1e3).toISOString().slice(0,10)}function tt(t,e){let n=(0,T.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function v(t,e){let n=(0,T.normalizePath)(e).split("/"),a="";for(let o of n)a=a?`${a}/${o}`:o,t.vault.getAbstractFileByPath(a)||await t.vault.createFolder(a)}async function j(t,e,n){let a=(0,T.normalizePath)(e),o=tt(t,a);if(!o)return await v(t,a.split("/").slice(0,-1).join("/")),t.vault.create(a,n);if(o instanceof T.TFile)return t.vault.modify(o,n)}var et=(t,e,n)=>t.split(e).join(n),nt=(t=new Date)=>t.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"});function at(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);let a=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-a.getTime())/864e5+1)/7)}function ot(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function rt(t,e,n=".md"){let a=(0,d.normalizePath)(e+n),o=1;for(;t.vault.getAbstractFileByPath(a);)a=(0,d.normalizePath)(`${e} (${o})${n}`),o++;return a}function it(t,e={}){let n=new Date,a={"{{date}}":b(n),"{{dateLong}}":nt(n),"{{year}}":String(n.getFullYear()),"{{monthShort}}":n.toLocaleString("en-US",{month:"short"}),"{{isoWeek}}":String(at(n)),"{{quarter}}":String(Math.floor(n.getMonth()/3)+1),...e},o=t;for(let r in a)o=et(o,r,a[r]);return o}function R(t){return{task:["\u{1F4CC}","Task"],project:["\u{1F680}","Project"],goal:["\u{1F3AF}","Goal"],habit:["\u{1F504}","Habit"],note:["\u270F\uFE0F","Note"],area:["\u{1F331}","Area"]}[t]}async function st(t,e){let[,n]=R(e),a=(0,d.normalizePath)(`03 SaveBox/Templates/${n} Template.md`),o=t.vault.getAbstractFileByPath(a),r=(0,d.normalizePath)(`99 Templates/${n}.md`),c=t.vault.getAbstractFileByPath(r),i=o??c;return i&&i instanceof d.TFile?await t.vault.read(i):`---
created: {{date}}
due: 
status: Active
done: false
---

# {{emoji}}{{label}} - {{core}}

- [ ] {{emoji}}{{label}} - {{core}}
`}function ct(t,e){let n=/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/,a=t.match(n);if(a){let o=(0,d.parseYaml)(a[1])??{};o.created||(o.created=e),"due"in o||(o.due="");let r=(0,d.stringifyYaml)(o).trimEnd();r=r.replace(/^due:\s*(['"])?\1?$/m,"due: ");let c=a[0].includes(`\r
`)?`\r
`:`
`;return t.replace(a[0],`---${c}${r}${c}---${c}`)}return`---
created: ${e}
due: 
---
`+t}function lt(t,e){if(!e||e.length===0)return t;let n=/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/,a=t.match(n);if(!a)return`---
${(0,d.stringifyYaml)({aliases:Array.from(new Set(e))}).trimEnd()}
---
`+t;let o=(0,d.parseYaml)(a[1])??{},r=Array.isArray(o.aliases)?o.aliases:o.aliases?[o.aliases]:[],c=Array.from(new Set([...r,...e].filter(Boolean)));if(c.length===0)return t;o.aliases=c;let i=a[0].includes(`\r
`)?`\r
`:`
`,s=(0,d.stringifyYaml)(o).trimEnd();return t.replace(a[0],`---${i}${s}${i}---${i}`)}async function O(t,e,n,a){let[o,r]=R(e),c="03 SaveBox/Active";await v(t,c);let i=ot(n)||"Untitled",s=`${c}/${o}${r} - ${i}`,l=await rt(t,s),u=await st(t,e);u=it(u,{"{{title}}":`${o}${r} - ${i}`,"{{kind}}":r,"{{emoji}}":o,"{{core}}":i}),u=ct(u,b()),a?.aliases?.length&&(u=lt(u,a.aliases));let g=await t.vault.create(l,u);return await t.workspace.getLeaf(!1).openFile(g),new d.Notice(`${r} created: ${i}`),g}var S=require("obsidian");function ut(t,e){return t.toLocaleDateString("en-US",e)}function L(t=new Date){return ut(t,{day:"2-digit",month:"short",year:"numeric"})}function gt(t=new Date){let e="02 Execution/1 Daily",n=`${L(t)}.md`;return(0,S.normalizePath)(`${e}/${n}`)}async function N(t){let e=gt();await v(t,e.split("/").slice(0,-1).join("/"));let n=`# ${L()}

### \u270D\uFE0F Fleeting Notes
- 
`;await j(t,e,n);let a=t.vault.getAbstractFileByPath(e);if(a&&a instanceof S.TFile)return await t.workspace.getLeaf(!0).openFile(a),a;throw new Error("Failed to create/open today's note.")}var m=require("obsidian");var dt=/^(task|project|goal|area|habit|note)\s*(?:[-–—]\s*)?(.*)$/i,U={task:["\u{1F4CC}","Task"],project:["\u{1F680}","Project"],goal:["\u{1F3AF}","Goal"],area:["\u{1F331}","Area"],habit:["\u{1F504}","Habit"],note:["\u270F\uFE0F","Note"]};function mt(t,e={}){let n=new Date,a=n.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric"}),o=i=>{let s=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())),l=s.getUTCDay()||7;s.setUTCDate(s.getUTCDate()+4-l);let u=new Date(Date.UTC(s.getUTCFullYear(),0,1));return Math.ceil(((s.getTime()-u.getTime())/864e5+1)/7)},r={"{{date}}":b(n),"{{dateLong}}":a,"{{year}}":String(n.getFullYear()),"{{monthShort}}":n.toLocaleString("en-US",{month:"short"}),"{{isoWeek}}":String(o(n)),"{{quarter}}":String(Math.floor(n.getMonth()/3)+1),...e},c=t;for(let i in r)c=c.split(i).join(r[i]);return c}function ft(t,e){let n=/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/,a=t.match(n);if(a){let o=(0,m.parseYaml)(a[1])??{};o.created||(o.created=e),"due"in o||(o.due="");let r=(0,m.stringifyYaml)(o).trimEnd();r=r.replace(/^due:\s*(['"])?\1?$/m,"due: ");let c=a[0].includes(`\r
`)?`\r
`:`
`;return t.replace(a[0],`---${c}${r}${c}---${c}`)}return`---
created: ${e}
due: 
---
`+t}async function pt(t,e){let[,n]=U[e],a=(0,m.normalizePath)(`03 SaveBox/Templates/${n} Template.md`),o=t.vault.getAbstractFileByPath(a);return o instanceof m.TFile?t.vault.read(o):`---
created: {{date}}
due: 
status: Active
done: false
---

# {{emoji}}{{label}} - {{core}}

- [ ] {{emoji}}{{label}} - {{core}}
`}async function ht(t,e,n=".md"){let a=(0,m.normalizePath)(e+n),o=1;for(;t.vault.getAbstractFileByPath(a);)a=(0,m.normalizePath)(`${e} (${o})${n}`),o++;return a}function yt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function wt(t,e,n){let a=t.workspace.getActiveViewOfType(m.MarkdownView);if(!a)return;let o=a.editor,r=o.getValue(),c=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),i=new RegExp(`\\[\\[${c}(\\|[^\\]]+)?\\]\\]`,"g"),s=r.replace(i,`[[${n}]]`);if(s!==r){let l=o.getCursor();o.setValue(s),o.setCursor(l)}}function B(t){console.log("MMOS wikilink watcher: ON"),t.vault.on("create",async e=>{try{if(!(e instanceof m.TFile)||e.extension.toLowerCase()!=="md")return;let n=e.basename.trim(),a=dt.exec(n);if(!a)return;let o=a[1].toLowerCase(),r=(a[2]||"").trim()||"Untitled",[c,i]=U[o];if((await t.vault.read(e)).trim().length>0)return;let l=yt(r),u=(0,m.normalizePath)(`03 SaveBox/Active/${c}${i} - ${l}`),g=await ht(t,u,".md");await t.fileManager.renameFile(e,g);let p=await pt(t,o);p=mt(p,{"{{title}}":`${c}${i} - ${l}`,"{{kind}}":i,"{{emoji}}":c,"{{core}}":l}),p=ft(p,b()),await t.vault.modify(e,p),await wt(t,n,`${c}${i} - ${l}`),console.log(`MMOS wikilink routed \u2192 ${o} | ${l}`)}catch(n){console.error("MMOS wikilink routing error:",n)}})}var K=require("obsidian");function Tt(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function bt(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function _(t,e){let a=new RegExp(`^#{1,6}\\s+${Tt(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,r=(a[0].match(/^#+/)||["#"])[0].length,c=new RegExp(`^#{1,${r}}\\s+`,"gim");c.lastIndex=o;let i=c.exec(t);return{start:o,end:i?i.index:t.length}}var I=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function Y(t,e){let n=t.slice(e.start,e.end);I.lastIndex=0;let a=I.exec(n);if(!a)return null;let o=e.start+a.index,r=o+a[0].length,c=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:r,line:a[0],checked:c}}function z(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var $t=2e3;function kt(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function vt(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function At(t){return/<%[\s\S]*?%>/.test(t)}function St(t){let e=t?.stat?.ctime??0;return Date.now()-e<$t}function V(t){let e=new Set,n=t.vault.on("modify",s=>{e.has(s.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),a=s=>{let l=t.workspace.getActiveViewOfType(K.MarkdownView),g=!!l&&l.file?.path===s.path&&l?.getMode()!=="preview";return{editor:l?.editor,inEdit:g}},o=async(s,l)=>{e.add(s.path);try{await t.fileManager.processFrontMatter(s,u=>{for(let g of Object.keys(l))u[g]=l[g]})}finally{e.delete(s.path)}},r=async(s,l,u,g,p)=>{let{editor:f,inEdit:P}=a(s);e.add(s.path);try{if(P&&f){let w=f.offsetToPos(u),y=f.offsetToPos(g);await new Promise(requestAnimationFrame),f.replaceRange(p,w,y)}else{let w=l.slice(0,u)+p+l.slice(g);w!==l&&await t.vault.modify(s,w)}}finally{e.delete(s.path)}},i=bt(async()=>{let s=t.workspace.getActiveFile();if(!s||kt(s.path))return;let u=(t.metadataCache.getFileCache(s)??{}).frontmatter??{};if(vt(u))return;let{editor:g,inEdit:p}=a(s),f=p&&g?g.getValue():await t.vault.read(s);if(!f||At(f)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(f)||St(s)||e.has(s.path))return;let w=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let y of w){let E=_(f,y.heading);if(!E)continue;let $=Y(f,E);if(!$)continue;let A=typeof u.done=="boolean"?u.done:null,F=typeof u[y.flag]=="boolean"?u[y.flag]:null,k=$.checked;if(F===null){await o(s,{done:!!k,[y.flag]:!!k});return}let W=A!==null&&A!==F;if(k!==F){await o(s,{done:!!k,[y.flag]:!!k});return}if(W){let G=z($.line,!!A);await r(s,f,$.absStart,$.absEnd,G),await o(s,{[y.flag]:!!A});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function D(t,e){let a=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},o=!(typeof a.done=="boolean"&&a.done);await t.fileManager.processFrontMatter(e,i=>{i.done=o});let r=await t.vault.read(e),c=["My Task","My Project","My Goal"];for(let i of c){let s=_(r,i);if(!s)continue;let l=Y(r,s);if(!l)continue;let u=z(l.line,o),g=r.slice(0,l.absStart)+u+r.slice(l.absEnd);g!==r&&await t.vault.modify(e,g);break}}var C=class extends h.Modal{constructor(n,a){super(n);this.opts=a;this.value=""}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("h3",{text:this.opts.title});let a=null;new h.Setting(n).addText(o=>{a=o.inputEl,o.setPlaceholder(this.opts.placeholder??"").onChange(r=>{this.value=r}),setTimeout(()=>a?.focus(),0)}).addButton(o=>{o.setCta().setButtonText(this.opts.cta??"Create").onClick(()=>{let r=this.value.trim();r&&(this.close(),this.opts.onSubmit(r))})}),n.onkeydown=o=>{if(o.key==="Enter"){let r=this.value.trim();if(!r)return;this.close(),this.opts.onSubmit(r)}}}onClose(){this.contentEl.empty()}},x=class extends h.Plugin{async onload(){B(this.app),V(this.app),this.addCommand({id:"mindmapos-toggle-done",name:"MindMap OS: Toggle Done",callback:async()=>{let n=this.app.workspace.getActiveFile();if(!n)return new h.Notice("No active file.");await D(this.app,n)}});let e=(n,a)=>{this.addCommand({id:`mindmapos-new-${n}`,name:`MindMap OS: New ${a}`,callback:()=>{new C(this.app,{title:`New ${a}`,placeholder:`Enter ${a.toLowerCase()} title`,cta:`Create ${a}`,onSubmit:async o=>{await O(this.app,n,o)}}).open()}})};e("task","Task"),e("project","Project"),e("goal","Goal"),e("area","Area"),e("habit","Habit"),e("note","Note"),this.addCommand({id:"mindmapos-toggle-done",name:"MindMap OS: Toggle Done",callback:async()=>{let n=this.app.workspace.getActiveFile();if(!n)return new h.Notice("No active file.");await D(this.app,n)}}),this.addCommand({id:"mindmapos-open-today",name:"MindMap OS: Open Today",callback:async()=>{let n=await N(this.app);n&&await this.app.workspace.getLeaf(!1).openFile(n)}}),new h.Notice("MindMap OS loaded \u2705")}onunload(){console.log("MindMap OS unloaded")}};
