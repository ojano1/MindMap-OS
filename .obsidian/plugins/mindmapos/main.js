/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var H=Object.defineProperty;var yt=Object.getOwnPropertyDescriptor;var mt=Object.getOwnPropertyNames;var gt=Object.prototype.hasOwnProperty;var ht=(t,e)=>{for(var a in e)H(t,a,{get:e[a],enumerable:!0})},ft=(t,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of mt(e))!gt.call(t,o)&&o!==a&&H(t,o,{get:()=>e[o],enumerable:!(n=yt(e,o))||n.enumerable});return t};var wt=t=>ft(H({},"__esModule",{value:!0}),t);var re={};ht(re,{default:()=>N});module.exports=wt(re);var D=require("obsidian");var z=require("obsidian");var E=require("obsidian");function f(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function kt(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function xt(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function bt(t=new Date){return t.getFullYear()}function Tt(t=new Date){return Math.floor(t.getMonth()/3)+1}function Mt(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let a=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+a)/864e5+1)/7)}function q(t,e,a=new Date){let n={"{{title}}":e,"{{date}}":f(a),"{{dateLong}}":a.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),"{{weekday}}":kt(a),"{{monthShort}}":xt(a),"{{year}}":String(bt(a)),"{{isoWeek}}":String(Mt(a)),"{{quarter}}":String(Tt(a))},o=t;for(let[i,c]of Object.entries(n))o=o.split(i).join(c);return o}function vt(t,e){let a=(0,E.normalizePath)(e);return t.vault.getAbstractFileByPath(a)??null}async function P(t,e){let a=(0,E.normalizePath)(e).split("/"),n="";for(let o of a)n=n?`${n}/${o}`:o,t.vault.getAbstractFileByPath(n)||await t.vault.createFolder(n)}async function k(t,e,a){let n=(0,E.normalizePath)(e);if(!vt(t,n)){let i=n.split("/").slice(0,-1).join("/");i&&await P(t,i),await t.vault.create(n,a)}}var L=require("obsidian");var x="03 SaveBox/Templates",I={area:`${x}/Area Template.md`,wish:`${x}/Wish Template.md`,goal:`${x}/Goal Template.md`,project:`${x}/Project Template.md`,task:`${x}/Task Template.md`,habit:`${x}/Habit Template.md`,note:`${x}/Note Template.md`,daily:`${x}/Daily Template.md`,weekly:`${x}/Weekly Template.md`,monthly:`${x}/Monthly Template.md`,quarterly:`${x}/Quarterly Template.md`,yearly:`${x}/Yearly Template.md`},R={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function O(t,e,a,n=new Date){let o=(0,L.normalizePath)(I[e]),i=t.vault.getAbstractFileByPath(o);return i instanceof L.TFile?(console.log(`[MMOS] Using VAULT template for ${e}: ${o}`),await t.vault.read(i)):(console.log(`[MMOS] Using FALLBACK template for ${e}`),q(R[e],a,n))}async function U(t,e){let{kind:a,title:n}=e,o=e.path??At(a,n),i=o.substring(0,o.lastIndexOf("/"));i&&await P(t,i);let c=await O(t,a,n,new Date),s=await t.vault.create(o,c);return await t.fileManager.processFrontMatter(s,r=>{r.created??(r.created=f(new Date)),a==="task"?(r.status??(r.status="Active"),r.impact??(r.impact="Med"),r.slot??(r.slot="Morning"),r.done??(r.done=!1),r.priority??(r.priority="Medium")):a==="goal"||a==="project"||a==="habit"?(r.status??(r.status="Active"),r.done??(r.done=!1),r.priority??(r.priority="Medium")):(a==="area"||a==="note")&&(r.status??(r.status="Active"))}),s}async function Q(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let a of e)await P(t,a);await k(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await k(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await k(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await k(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await k(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[a,n]of Object.entries(I))await k(t,n,R[a]);await k(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${f(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await k(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${f(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await k(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${f(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await k(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${f(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await k(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new z.Notice("\u2705 MindMap OS: starter structure updated.")}function At(t,e){let a=Dt(e);switch(t){case"daily":return`02 Execution/1 Daily/${a}.md`;case"weekly":return`02 Execution/2 Weekly/${a}.md`;case"monthly":return`02 Execution/3 Monthly/${a}.md`;case"quarterly":return`02 Execution/4 Quarterly/${a}.md`;case"yearly":return`02 Execution/5 Yearly/${a}.md`;case"note":return`03 SaveBox/Active/${a}.md`;default:return`03 SaveBox/Active/${St(t)}${a}.md`}}function St(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";default:return""}}function Dt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var C=require("obsidian");var Ft=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],Et={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function $t(t){return t instanceof C.TFile&&t.extension.toLowerCase()==="md"}function Pt(t){let e=t.match(/^(\w+)\s*(?:[-â€“]\s*|\s+)(.+)$/i);if(!e)return null;let a=e[1].toLowerCase();if(!Ft.includes(a))return null;let n=e[2].trim();return{kind:a,title:n}}function Lt(t,e){let a=Ot(e);switch(t){case"daily":return`02 Execution/1 Daily/${a}.md`;case"weekly":return`02 Execution/2 Weekly/${a}.md`;case"monthly":return`02 Execution/3 Monthly/${a}.md`;case"quarterly":return`02 Execution/4 Quarterly/${a}.md`;case"yearly":return`02 Execution/5 Yearly/${a}.md`;case"note":return`03 SaveBox/Active/${a}.md`;default:return`03 SaveBox/Active/${Et[t]}${a}.md`}}function Ot(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function Ct(t,e,a){await t.fileManager.processFrontMatter(e,n=>{n.created??(n.created=f(new Date)),a==="task"?(n.status??(n.status="Active"),n.impact??(n.impact="Medium"),n.slot??(n.slot="Morning"),n.done??(n.done=!1),n.duration_hours??(n.duration_hours=void 0),n.tags??(n.tags=[])):a==="goal"||a==="project"||a==="habit"?(n.status??(n.status="Active"),n.done??(n.done=!1)):(a==="area"||a==="note")&&(n.status??(n.status="Active"))})}function V(t){t.vault.on("create",async e=>{try{if(!$t(e)||(await t.vault.read(e)).trim().length>0)return;let n=e.basename,o=Pt(n);if(!o)return;let{kind:i,title:c}=o,s=await O(t,i,c,new Date);await t.vault.modify(e,s),await Ct(t,e,i);let r=(0,C.normalizePath)(Lt(i,c));r!==e.path&&await t.fileManager.renameFile(e,r),console.log(`[MMOS] wikilink routed \u2192 ${i} | ${c}`)}catch(a){console.error("[MMOS] wikilink routing error",a)}}),console.log("MMOS wikilink watcher: ON")}var J=require("obsidian");function jt(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Wt(t,e){let a=null;return(...n)=>{a&&window.clearTimeout(a),a=window.setTimeout(()=>{a=null,t(...n)},e)}}function Z(t,e){let n=new RegExp(`^#{1,6}\\s+${jt(e)}\\s*$`,"gim").exec(t);if(!n)return null;let o=n.index+n[0].length,i=(n[0].match(/^#+/)||["#"])[0].length,c=new RegExp(`^#{1,${i}}\\s+`,"gim");c.lastIndex=o;let s=c.exec(t);return{start:o,end:s?s.index:t.length}}var X=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function tt(t,e){let a=t.slice(e.start,e.end);X.lastIndex=0;let n=X.exec(a);if(!n)return null;let o=e.start+n.index,i=o+n[0].length,c=/\[(x|X)\]/.test(n[0]);return{absStart:o,absEnd:i,line:n[0],checked:c}}function et(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var Bt=2e3;function Nt(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function Yt(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function Ht(t){return/<%[\s\S]*?%>/.test(t)}function It(t){let e=t?.stat?.ctime??0;return Date.now()-e<Bt}function at(t){let e=new Set,a=t.vault.on("modify",r=>{e.has(r.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),n=r=>{let u=t.workspace.getActiveViewOfType(J.MarkdownView),l=!!u&&u.file?.path===r.path&&u?.getMode()!=="preview";return{editor:u?.editor,inEdit:l}},o=async(r,u)=>{e.add(r.path);try{await t.fileManager.processFrontMatter(r,d=>{for(let l of Object.keys(u))d[l]=u[l]})}finally{e.delete(r.path)}},i=async(r,u,d,l,p)=>{let{editor:y,inEdit:h}=n(r);e.add(r.path);try{if(h&&y){let b=y.offsetToPos(d),w=y.offsetToPos(l);await new Promise(requestAnimationFrame),y.replaceRange(p,b,w)}else{let b=u.slice(0,d)+p+u.slice(l);b!==u&&await t.vault.modify(r,b)}}finally{e.delete(r.path)}},s=Wt(async()=>{let r=t.workspace.getActiveFile();if(!r||Nt(r.path))return;let d=(t.metadataCache.getFileCache(r)??{}).frontmatter??{};if(Yt(d))return;let{editor:l,inEdit:p}=n(r),y=p&&l?l.getValue():await t.vault.read(r);if(!y||Ht(y)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(y)||It(r)||e.has(r.path))return;let b=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let w of b){let F=Z(y,w.heading);if(!F)continue;let m=tt(y,F);if(!m)continue;let g=typeof d.done=="boolean"?d.done:null,A=typeof d[w.flag]=="boolean"?d[w.flag]:null,T=m.checked;if(A===null){await o(r,{done:!!T,[w.flag]:!!T});return}let M=g!==null&&g!==A;if(T!==A){await o(r,{done:!!T,[w.flag]:!!T});return}if(M){let v=et(m.line,!!g);await i(r,y,m.absStart,m.absEnd,v),await o(r,{[w.flag]:!!g});return}return}},150);t.workspace.on("file-open",()=>s()),t.workspace.on("active-leaf-change",()=>s()),t.workspace.on("layout-change",()=>s()),t.workspace.on("editor-change",()=>s()),t.metadataCache.on("changed",()=>s()),t.metadataCache.on("resolved",()=>s()),t.vault.on("modify",()=>s()),t.vault.on("rename",()=>s()),t.vault.on("create",()=>s())}async function nt(t,e){let n=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},o=!(typeof n.done=="boolean"&&n.done);await t.fileManager.processFrontMatter(e,s=>{s.done=o});let i=await t.vault.read(e),c=["My Task","My Project","My Goal"];for(let s of c){let r=Z(i,s);if(!r)continue;let u=tt(i,r);if(!u)continue;let d=et(u.line,o),l=i.slice(0,u.absStart)+d+i.slice(u.absEnd);l!==i&&await t.vault.modify(e,l);break}}var W=require("obsidian");var j=window.moment,_=new Set;function Rt(t){let e=t.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n?/);if(!e)return null;let a=e[1],n={};for(let o of a.split(/\r?\n/)){let i=o.match(/^\s*([A-Za-z0-9_\-]+)\s*:\s*(.*)\s*$/);if(!i)continue;let c=i[1],s=i[2];/^(true|false)$/i.test(s)&&(s=/^true$/i.test(s)),n[c]=s}return n}var _t={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},K={};for(let[t,e]of Object.entries(_t))for(let a of e)K[a.toLowerCase()]=t;var Kt=Object.keys(K).sort((t,e)=>e.length-t.length).join("|"),Gt=new RegExp(`\\b(?:${Kt})\\b`,"gi");function qt(t){let e=t.match(Gt);return e?[...new Set(e.map(a=>K[a.toLowerCase()]).filter(Boolean))]:[]}function zt(t){let e=[],a=t.toLowerCase();/\b(last|akhir)\b/i.test(a)&&e.push("last");let n=/\b(?:day|tgl|tanggal|d|hari|#)?\s*(\d{1,2})(?:st|nd|rd|th)?\b/gi,o;for(;o=n.exec(a);){let s=Number(o[1]);s>=1&&s<=31&&e.push(s)}let i=new Set,c=[];for(let s of e){let r=String(s);i.has(r)||(i.add(r),c.push(s))}return c}function Ut(t){let a=/^#{1,6}\s*.*?\blog\b.*$/gim.exec(t);if(!a)return null;let n=t.indexOf(`
`,a.index);return n===-1?t.length:n+1}function Qt(t,e){if((Rt(t)?.type||"").toString().toLowerCase()==="habit")return!0;let n=e.path.toLowerCase(),o=e.basename.toLowerCase();return!!(n.includes("/habits/")||o.startsWith("\u{1F504}habit - ".toLowerCase())||o.startsWith("habit - ")||o.includes("habit"))}function Vt(t){let e=j().format("dddd"),a=Number(j().format("D")),n=Number(j().endOf("month").format("D")),o=qt(t);if(o.length)return o.includes(e);let i=zt(t);if(i.length){for(let c of i)if(c==="last"&&a===n||typeof c=="number"&&c===a)return!0;return!1}return!0}async function rt(t,e,a,n){let o=j().format("YYYY-MM-DD"),i=`^${o}`;if(a.includes(i))return console.info("[MindMapOS] autolog: already has today",{file:e.path}),!1;let c=e.basename.trim(),r=`- [ ] \u{1F501}Habit - ${n&&n.trim()||c.split(" - ").slice(1).join(" - ").trim()||c} ${o} ${i}`,u=Ut(a),d=a;return u!==null?d=a.slice(0,u)+r+`
`+a.slice(u):d=a.trimEnd()+`

### \u270D\uFE0F Log
${r}
`,await t.vault.modify(e,d),console.info("[MindMapOS] autolog: inserted",{file:e.path,line:r}),!0}async function $(t,e){let a=e.path;if(!_.has(a)){_.add(a);try{let n=await t.vault.read(e);if(!Qt(n,e)){console.info("[MindMapOS] autolog: skip (not habit)",{file:e.path});return}if(!Vt(e.basename)){console.info("[MindMapOS] autolog: skip (by name cadence)",{file:e.path,basename:e.basename});return}await rt(t,e,n)}finally{setTimeout(()=>_.delete(a),120)}}}async function ot(t,e){let a=await t.vault.read(e);await rt(t,e,a)}var Xt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - "};function Jt(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function Zt(t,e){let a=Jt(e);switch(t){case"daily":return`02 Execution/1 Daily/${a}.md`;case"weekly":return`02 Execution/2 Weekly/${a}.md`;case"monthly":return`02 Execution/3 Monthly/${a}.md`;case"quarterly":return`02 Execution/4 Quarterly/${a}.md`;case"yearly":return`02 Execution/5 Yearly/${a}.md`;case"note":return`03 SaveBox/Active/${a}.md`;default:return`03 SaveBox/Active/${Xt[t]}${a}.md`}}function te(t,e){let a=t.vault.getAbstractFileByPath((0,W.normalizePath)(e));return a instanceof W.TFile?a:null}function ee(t){let e=t.trim().toLowerCase(),a=new Date;return e==="today"?f(a):e==="tomorrow"?(a.setDate(a.getDate()+1),f(a)):e==="yesterday"?(a.setDate(a.getDate()-1),f(a)):/^\d{4}-\d{2}-\d{2}$/.test(t)?t:f(a)}async function B(t,e,a){let n=a;e==="daily"&&(n=ee(a));let o=Zt(e,n),i=te(t,o);if(i){if(e==="habit")try{await $(t,i)}catch(s){console.error(s)}return await t.workspace.getLeaf(!1).openFile(i),i}let c=await U(t,{kind:e,title:n});if(e==="habit")try{await $(t,c)}catch(s){console.error(s)}return await t.workspace.getLeaf(!1).openFile(c),c}var it=(t,e)=>B(t,"task",e),st=(t,e)=>B(t,"project",e),ct=(t,e)=>B(t,"goal",e);var lt=(t,e="today")=>B(t,"daily",e);var G=require("obsidian"),S=window.moment;function dt(t){return S(t).format("YYYY-MM-DD")}async function ut(t,e){let n=(await t.vault.read(e)).split(/\r?\n/),o=/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/,i=/due\((\d{4}-\d{2}-\d{2})\)/i,c=/due::\s*(\d{4}-\d{2}-\d{2})/i,s=/ðŸ“…\s*(\d{4}-\d{2}-\d{2})/,r=[];for(let d of n){let l=d.match(/^\s*-\s\[( |x)\]\s(.*)$/i);if(!l)continue;let p=l[1].toLowerCase()==="x",y=l[2],h=y.match(o)||y.match(i)||y.match(c)||y.match(s);if(!h)continue;let b=h[1];r.push({date:b,done:p})}let u=new Map;for(let d of r)u.set(d.date,u.get(d.date)||!1||d.done);return[...u.entries()].map(([d,l])=>({date:d,done:l})).sort((d,l)=>d.date.localeCompare(l.date))}async function ae(t,e,a){let n=await ut(t,a);if(!n.length){e.createEl("p",{text:"No habit data yet."});return}let o={};for(let l of n){let p=S(l.date).format("YYYY-MM");(o[p]||(o[p]=[])).push(l)}let c=Object.keys(o).sort().slice(-3).reverse().map(l=>{let p=o[l],y=p.length?Math.round(p.filter(h=>h.done).length/p.length*100):0;return{label:S(l,"YYYY-MM").format("MMM"),pct:y}}),s=0;{let l=S();for(let p=0;p<90;p++){let y=dt(l);if(n.find(h=>h.date===y&&h.done))s++;else break;l.subtract(1,"day")}}let r=e.createDiv({cls:"habit-monthly-summary"});r.createEl("p",{text:`\u{1F525} Current streak: ${s} day${s===1?"":"s"}`});let u=r.createDiv({cls:"month-bars"});c.forEach(({label:l,pct:p},y)=>{let h=u.createDiv({cls:"month-row"});h.innerHTML=`
      <div class="month-label">${l}</div>
      <div class="bar-track"><div class="bar-fill ${y===0?"bar-orange":"bar-purple"}" style="width:${p}%;"></div></div>
      <div class="pct-text">${p}<span class="pct-symbol">%</span></div>
    `});let d=document.createElement("style");d.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width:3ch; text-align:right; font-weight:600; font-size:.95em; }

.bar-track {
  position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden;
  background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent);
}
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }

.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
`,r.appendChild(d)}async function ne(t,e,a){let n=await ut(t,a);if(!n.length){e.createEl("p",{text:"No habit tasks found."});return}let o=new Map;for(let m of n)o.set(m.date,o.get(m.date)||!1||m.done);let i=[...o.keys()].sort(),s=S().startOf("day").clone(),r=s.clone().subtract(29,"days"),u=r.clone().startOf("isoWeek"),d=s.clone().endOf("isoWeek"),l=null;for(let m=i.length-1;m>=0;m--){let g=i[m];if(!S(g).isAfter(s)&&o.get(g)){l=g;break}}let p=e.createDiv({cls:"weekly-streak-wrap"}),y=p.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(m=>y.createDiv({cls:"head",text:m}));let h=p.createDiv({cls:"weekly-streak-grid"}),b=[],w=d.clone().endOf("isoWeek");for(;w.isSameOrAfter(u);){let m=w.clone().startOf("isoWeek");b.push({weekStart:m.clone(),weekEnd:w.clone()}),w.subtract(1,"week")}for(let m of b){let g=m.weekStart.clone();for(let A=0;A<7;A++){let T=dt(g),M=g.isSameOrAfter(r)&&g.isSameOrBefore(s),Y=M?!!o.get(T):!1,v=h.createDiv({cls:"weekly-streak-cell"});M||v.classList.add("pad"),Y&&M&&(v.classList.add("hit"),T===l&&v.classList.add("latest-hit")),v.createDiv({cls:"num",text:M?g.format("D"):""}),v.createDiv({cls:"mmm",text:M?g.format("MMM"):""}),v.setAttr("title",M?`${g.format("ddd, DD MMM YYYY")} ${Y?"\u2705 Done":"\u274C Missed"}`:""),g.add(1,"day")}}let F=document.createElement("style");F.textContent=`
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head {
  display:grid; grid-template-columns: repeat(7, 1fr);
  gap:6px; max-width:520px; margin-bottom:6px;
}
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }

.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell {
  aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border);
  display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px;
}
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }

.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }

.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }

.weekly-streak-cell.pad { opacity:.35; }
`,p.appendChild(F)}function pt(t,e){e("mindmapos-habit-monthly",async(a,n,o)=>{let i=t.vault.getAbstractFileByPath(o.sourcePath);i instanceof G.TFile&&await ae(t,n,i)}),e("mindmapos-habit-grid",async(a,n,o)=>{let i=t.vault.getAbstractFileByPath(o.sourcePath);i instanceof G.TFile&&await ne(t,n,i)})}var N=class extends D.Plugin{async onload(){console.log("MindMap OS loaded"),V(this.app),at(this.app),pt(this.app,this.registerMarkdownCodeBlockProcessor.bind(this));let e=async n=>{if(n)try{await $(this.app,n)}catch(o){console.error("[MindMapOS] autolog error",o)}},a=n=>{n&&(e(n),window.setTimeout(()=>e(n),150),window.setTimeout(()=>e(n),600))};this.app.workspace.onLayoutReady(()=>{let n=this.app.workspace.getActiveFile();window.setTimeout(()=>a(n),50)}),this.registerEvent(this.app.workspace.on("file-open",n=>a(n))),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{let n=this.app.workspace.getActiveFile();a(n)})),this.registerEvent(this.app.metadataCache.on("resolved",()=>{let n=this.app.workspace.getActiveFile();a(n)})),this.addCommand({id:"mmos-create-starter-structure",name:"Create Starter Structure",callback:async()=>{await Q(this.app),new D.Notice("Starter structure created.")}}),this.addCommand({id:"mmos-open-today",name:"Open Today",callback:async()=>{await lt(this.app,"today")}}),this.addCommand({id:"mmos-new-task",name:"New Task\u2026",callback:async()=>{await it(this.app,"New Task")}}),this.addCommand({id:"mmos-new-project",name:"New Project\u2026",callback:async()=>{await st(this.app,"New Project")}}),this.addCommand({id:"mmos-new-goal",name:"New Goal\u2026",callback:async()=>{await ct(this.app,"New Goal")}}),this.addCommand({id:"mmos-toggle-done",name:"Toggle Done (YAML \u2194 checkbox)",callback:async()=>{let n=this.app.workspace.getActiveFile();n?await nt(this.app,n):new D.Notice("No active file to toggle.")}}),this.addCommand({id:"mmos-habit-force-today",name:"Habit: Add Today\u2019s Log (force)",callback:async()=>{let n=this.app.workspace.getActiveFile();if(!n)return new D.Notice("No active file.");await ot(this.app,n)}}),console.log("MindMap OS ready")}onunload(){console.log("MindMap OS unloaded")}};
