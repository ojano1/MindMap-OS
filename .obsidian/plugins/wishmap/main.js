/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, see the repository of this plugin.
*/
"use strict";var q=Object.defineProperty;var Nt=Object.getOwnPropertyDescriptor;var Kt=Object.getOwnPropertyNames;var Gt=Object.prototype.hasOwnProperty;var qt=(t,e)=>{for(var n in e)q(t,n,{get:e[n],enumerable:!0})},Ut=(t,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Kt(e))!Gt.call(t,o)&&o!==n&&q(t,o,{get:()=>e[o],enumerable:!(a=Nt(e,o))||a.enumerable});return t};var zt=t=>Ut(q({},"__esModule",{value:!0}),t);var xn={};qt(xn,{default:()=>G});module.exports=zt(xn);var g=require("obsidian");var st=require("obsidian");var L=require("obsidian");function Xt(t,e,n){let a=t.metadataCache.getFileCache(e);if(!a?.headings)return null;let o=d=>d.trim().toLowerCase(),r=o(n),s=a.headings.sort((d,u)=>d.position.start.line-u.position.start.line),c=s.findIndex(d=>o(d.heading)===r);if(c===-1)return null;let i=s[c].position.end.line+1,l=c<s.length-1?s[c+1].position.start.line-1:Number.MAX_SAFE_INTEGER;return{startLine:i,endLine:l}}async function rt(t,e,n,a){let o=Xt(t,e,n);if(!o)return!1;let s=(await t.vault.read(e)).split(`
`),c=Math.min(o.startLine,s.length-1),i=Math.min(o.endLine,s.length-1),l=/^\s*-\s*\[([ xX])\]\s*(.*)$/;for(let d=c;d<=i;d++){let u=s[d].match(l);if(!u)continue;let f=`- [${u[1]==="x"||u[1]==="X"?"x":" "}] ${a}`;return s[d]!==f&&(s[d]=f,await t.vault.modify(e,s.join(`
`))),!0}return!1}function F(t=new Date){let e=t.getTimezoneOffset();return new Date(t.getTime()-e*6e4).toISOString().slice(0,10)}function Qt(t=new Date){return t.toLocaleDateString(void 0,{weekday:"long"})}function Vt(t=new Date){return t.toLocaleDateString(void 0,{month:"short"})}function Zt(t=new Date){return t.getFullYear()}function Jt(t=new Date){return Math.floor(t.getMonth()/3)+1}function te(t=new Date){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((+e-+n)/864e5+1)/7)}function U(t,e,n=new Date){let a=F(n),o=t;return o=o.replace(/{{\s*title\s*}}/gi,e),o=o.replace(/{{\s*date(?:\s*:\s*([^}]+))?\s*}}/gi,r=>a),o=o.replace(/{{\s*dateLong\s*}}/gi,n.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})),o=o.replace(/{{\s*weekday\s*}}/gi,Qt(n)),o=o.replace(/{{\s*monthShort\s*}}/gi,Vt(n)),o=o.replace(/{{\s*year\s*}}/gi,String(Zt(n))),o=o.replace(/{{\s*isoWeek\s*}}/gi,String(te(n))),o=o.replace(/{{\s*quarter\s*}}/gi,String(Jt(n))),o}function ee(t,e){let n=(0,L.normalizePath)(e);return t.vault.getAbstractFileByPath(n)??null}async function R(t,e){let n=(0,L.normalizePath)(e).split("/"),a="";for(let o of n)a=a?`${a}/${o}`:o,t.vault.getAbstractFileByPath(a)||await t.vault.createFolder(a)}async function k(t,e,n){let a=(0,L.normalizePath)(e);if(!ee(t,a)){let r=a.split("/").slice(0,-1).join("/");r&&await R(t,r),await t.vault.create(a,n)}}var H=require("obsidian");var T="03 SaveBox/Templates",z={area:`${T}/Area Template.md`,wish:`${T}/Wish Template.md`,goal:`${T}/Goal Template.md`,project:`${T}/Project Template.md`,task:`${T}/Task Template.md`,habit:`${T}/Habit Template.md`,note:`${T}/Note Template.md`,daily:`${T}/Daily Template.md`,weekly:`${T}/Weekly Template.md`,monthly:`${T}/Monthly Template.md`,quarterly:`${T}/Quarterly Template.md`,yearly:`${T}/Yearly Template.md`},X={area:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

This page defines one part of your life that matters.
Break it into **Wishes** you\u2019d love to reach.

## Step 1 \u2013 List Your Wishes
*Use links (prefix: \`wish \`).*
- [[wish \u2013 ]]
- 
`,wish:`---
created: {{date}}
status: Active
priority: Medium
tags: []
---
# {{title}}

Break this Wish into **Goals** you control.

## Step 1 \u2013 List Your Goals
**Action + measurable outcome + timeframe**

**Examples:**
- Launch 10 products in 4 months
- Build 1,000-subscriber email list in 3 months

### \u270D\uFE0F My Goals
- [[goal \u2013 ]]
- 
`,goal:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Goal
- [ ] {{title}}

Break this Goal into **Projects** (milestones).

## Step 1 \u2013 List Your Projects
**Deliverable + scope + time frame**

**Examples:**
- Build Product MVP in 4 weeks
- Create Email Launch Sequence in 6 weeks

### \u270D\uFE0F My Projects
- [[project \u2013 ]]
- 
`,project:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
### My Project
- [ ] {{title}}

Break it into **Tasks** and **Habits**.

## Tasks (\u22641h)
- [[task \u2013 ]]
- 

## Habits (repeatable)
- [[habit \u2013 ]]
- 
`,task:`---
created: 2025-10-16
_task_sync_state: false
done: false
status: Active
impact: Medium
slot: Morning
duration_hours:
tags: []
due:
---

### My Task
- [ ] {{title}}
A one-time action you can finish in about an hour.
---
### Properties to fill
- **Impact**: Select one in Properties. Options: Hi, Med, Lo.
- **duration_hours**: Set a number. Example: 0.5 or 1.
---
### Keep in mind
- Split big tasks to keep them small enough for one sitting (target 1hr max).
This way it would more friendly to your daily time budget.
---
[[Link to the daily page]]
---
<p align="center">MindMap OS \xA9 All rights reserved</p>
`,habit:`---
created: {{date}}
status: Active
done: false
priority: Medium
tags: []
---
# {{title}}

Describe the habit and frequency (e.g., daily, Mon Thu, monthly on the 1st).
`,note:`---
created: {{date}}
status: Active
tags: []
---
# {{title}}
Write freely. Link with [[...]].
`,daily:`# {{dateLong}}

## \u270D\uFE0F Inbox
- 

## Highlights
- 

## Next actions
- 
`,weekly:`# \u{1F4C5} Week {{isoWeek}} {{year}}
> Review goals and plan the week.
`,monthly:`# \u{1F4C5} {{monthShort}} {{year}}
> Review progress. Pick key projects and habits.
`,quarterly:`# \u{1F4C5} Q{{quarter}} {{year}}
> Choose focus goals. Align projects.
`,yearly:`# \u{1F4C5} Year {{year}}
> Define areas and high-level goals.
`};async function I(t,e,n,a=new Date){let o=(0,H.normalizePath)(z[e]),r=t.vault.getAbstractFileByPath(o);if(r instanceof H.TFile){console.log(`[MMOS] Using VAULT template for ${e}: ${o}`);let s=await t.vault.read(r);return U(s,n,a)}return console.log(`[MMOS] Using FALLBACK template for ${e}`),U(X[e],n,a)}async function ct(t,e){let{kind:n,title:a}=e,o=e.path??ne(n,a),r=o.substring(0,o.lastIndexOf("/"));r&&await R(t,r);let s=await I(t,n,a,new Date),c=await t.vault.create(o,s);return await t.fileManager.processFrontMatter(c,i=>{i.created??(i.created=F(new Date)),n==="task"?(i.status??(i.status="Active"),i.impact??(i.impact="Med"),i.slot??(i.slot="Morning"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):n==="goal"||n==="project"||n==="habit"?(i.status??(i.status="Active"),i.done??(i.done=!1),i.priority??(i.priority="Medium")):(n==="area"||n==="note")&&(i.status??(i.status="Active"))}),c}async function lt(t){let e=["01 Definition","02 Execution/1 Daily","02 Execution/2 Weekly","02 Execution/3 Monthly","02 Execution/4 Quarterly","02 Execution/5 Yearly","03 SaveBox/Active","03 SaveBox/Archive","03 SaveBox/Attachment","03 SaveBox/Scripts","03 SaveBox/Templates","04 Output","99 System"];for(let n of e)await R(t,n);await k(t,"Welcome.md",`# \u{1F44B} Welcome to MindMap OS

Use **MindMap OS \u2192 Create Starter Structure** any time.
`),await k(t,"01 Definition/\u{1F3C1} Start Here.md",`# \u{1F3C1} MindMap OS \u2013 Start Here

### Top-Down
Areas \u2192 Goals \u2192 Projects \u2192 Tasks. Best way to start.

### Bottom-Up
Capture anything anywhere. It lands in your **Daily inbox** for linking later.

### First step
Example: [[area Health]]
- 
- 
`),await k(t,"01 Definition/\u{1F9E0} Mind Map.md",`# \u{1F9E0} Mind Map
Link Areas, Goals, Projects here.
`),await k(t,"02 Execution/\u{1F50D} Read Me First.md",`# Execution Flow
Year \u2192 Quarter \u2192 Month \u2192 Week \u2192 Day.
`),await k(t,"04 Output/Untitled.md",`# Output
Export or publish here.
`);for(let[n,a]of Object.entries(z))await k(t,a,X[n]);await k(t,"03 SaveBox/Active/\u{1F331}Area - Life.md",`---
created: ${F(new Date)}
status: Active
---
# \u{1F331}Area - Life
`),await k(t,"03 SaveBox/Active/\u{1F3AF}Goal - Launch v1.md",`---
created: ${F(new Date)}
status: Active
done: false
---
### My Goal
- [ ] \u{1F3AF}Goal - Launch v1
`),await k(t,"03 SaveBox/Active/\u{1F680}Project - Landing Page.md",`---
created: ${F(new Date)}
status: Active
done: false
---
### My Project
- [ ] \u{1F680}Project - Landing Page
`),await k(t,"03 SaveBox/Active/\u{1F4CC}Task - Draft copy.md",`---
created: ${F(new Date)}
status: Active
impact: Med
slot: Morning
done: false
priority: Medium
duration_hours:
tags: []
---
### My Task
- [ ] \u{1F4CC}Task - Draft copy
`),await k(t,"99 System/Home.md",["# Welcome to MindMap OS","","- **MindMap OS \u2192 Create Starter Structure**","- **MindMap OS \u2192 New Goal / Project / Task**","- **MindMap OS \u2192 Open Today**",""].join(`
`)),new st.Notice("\u2705 MindMap OS: starter structure updated.")}function ne(t,e){let n=oe(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${ae(t)}${n}.md`}}function ae(t){switch(t){case"area":return"\u{1F331}Area - ";case"wish":return"\u2728Wish - ";case"goal":return"\u{1F3AF}Goal - ";case"project":return"\u{1F680}Project - ";case"task":return"\u{1F4CC}Task - ";case"habit":return"\u{1F501}Habit - ";default:return""}}function oe(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}var O=require("obsidian");var ie=["task","project","goal","area","habit","note","daily","weekly","monthly","quarterly","yearly","wish"],re={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - ",note:"",daily:"",weekly:"",monthly:"",quarterly:"",yearly:""};function se(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ce(t,e){let a=new RegExp(`^#{1,6}\\s+${se(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,r=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${r}}\\s+`,"gim");s.lastIndex=o;let c=s.exec(t);return{start:o,end:c?c.index:t.length}}function le(t,e){let n=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim,a=t.slice(e.start,e.end);n.lastIndex=0;let o=n.exec(a);if(!o)return null;let r=e.start+o.index,s=r+o[0].length,c=/\[(x|X)\]/.test(o[0]);return{absStart:r,absEnd:s,line:o[0],checked:c}}async function de(t,e){for(let n=0;n<25;n++){if(t.metadataCache.getFileCache(e)?.headings?.length)return;await new Promise(o=>setTimeout(o,40))}}async function ue(t,e,n,a){await de(t,e);let o=await t.vault.read(e),r=ce(o,n);if(!r)return!1;let s=le(o,r);if(!s)return!1;let i=`- [${/\[(x|X)\]/.test(s.line)?"x":" "}] ${a}`;if(s.line.trimEnd()===i)return!0;let l=o.slice(0,s.absStart)+i+o.slice(s.absEnd);return l!==o&&await t.vault.modify(e,l),!0}function he(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}function pe(t){return t instanceof O.TFile&&t.extension.toLowerCase()==="md"}function me(t){let e=t.match(/^(\w+)\s*(?:[-–]\s*|\s+)(.+)$/i);if(!e)return null;let n=e[1].toLowerCase();if(!ie.includes(n))return null;let a=e[2].trim();return{kind:n,title:a}}function fe(t,e){let n=ge(e);switch(t){case"daily":return`02 Execution/1 Daily/${n}.md`;case"weekly":return`02 Execution/2 Weekly/${n}.md`;case"monthly":return`02 Execution/3 Monthly/${n}.md`;case"quarterly":return`02 Execution/4 Quarterly/${n}.md`;case"yearly":return`02 Execution/5 Yearly/${n}.md`;case"note":return`03 SaveBox/Active/${n}.md`;default:return`03 SaveBox/Active/${re[t]}${n}.md`}}function ge(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}async function ye(t,e,n){await t.fileManager.processFrontMatter(e,a=>{a.created??(a.created=F(new Date)),n==="task"?(a.status??(a.status="Active"),a.impact??(a.impact="Medium"),a.slot??(a.slot="Morning"),a.done??(a.done=!1),a.duration_hours??(a.duration_hours=void 0),a.tags??(a.tags=[])):n==="goal"||n==="project"||n==="habit"?(a.status??(a.status="Active"),a.done??(a.done=!1)):(n==="area"||n==="note")&&(a.status??(a.status="Active"))})}function dt(t){t.vault.on("create",async e=>{try{if(!pe(e)||(await t.vault.read(e)).trim().length>0)return;let a=e.basename,o=me(a);if(!o)return;let{kind:r,title:s}=o,c=await I(t,r,s,new Date);await t.vault.modify(e,c),await ye(t,e,r);let i=(0,O.normalizePath)(fe(r,s));if(i!==e.path&&await t.fileManager.renameFile(e,i),r==="task"||r==="project"||r==="goal"){let l=t.vault.getAbstractFileByPath(i),d=l instanceof O.TFile?l:e,u=he(r),m=d.basename;await ue(t,d,u,m)}console.log(`[MMOS] wikilink routed \u2192 ${r} | ${s}`)}catch(n){console.error("[MMOS] wikilink routing error",n)}}),console.log("MMOS wikilink watcher: ON")}var ht=require("obsidian");function we(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function be(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function pt(t,e){let a=new RegExp(`^#{1,6}\\s+${we(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,r=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${r}}\\s+`,"gim");s.lastIndex=o;let c=s.exec(t);return{start:o,end:c?c.index:t.length}}var ut=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gim;function mt(t,e){let n=t.slice(e.start,e.end);ut.lastIndex=0;let a=ut.exec(n);if(!a)return null;let o=e.start+a.index,r=o+a[0].length,s=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:r,line:a[0],checked:s}}function ft(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}var xe=2e3;function ke(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function Te(t){return t?.template===!0||t?.is_template===!0||t?.type==="template"}function ve(t){return/<%[\s\S]*?%>/.test(t)}function Me(t){let e=t?.stat?.ctime??0;return Date.now()-e<xe}function gt(t,e){let n=new Set,a=t.vault.on("modify",l=>{n.has(l.path)&&t?.notifier?.hideAll&&t.notifier.hideAll()}),o=l=>{let d=t.workspace.getActiveViewOfType(ht.MarkdownView),m=!!d&&d.file?.path===l.path&&d?.getMode()!=="preview";return{editor:d?.editor,inEdit:m}},r=async(l,d)=>{n.add(l.path);try{await t.fileManager.processFrontMatter(l,u=>{for(let m of Object.keys(d))u[m]=d[m]})}finally{n.delete(l.path)}},s=async(l,d,u,m,f)=>{let{editor:h,inEdit:p}=o(l);n.add(l.path);try{if(p&&h){let y=h.offsetToPos(u),w=h.offsetToPos(m);await new Promise(requestAnimationFrame),h.replaceRange(f,y,w)}else{let y=d.slice(0,u)+f+d.slice(m);y!==d&&await t.vault.modify(l,y)}}finally{n.delete(l.path)}},i=be(async()=>{let l=t.workspace.getActiveFile();if(!l||e?.(l)||ke(l.path))return;let u=(t.metadataCache.getFileCache(l)??{}).frontmatter??{};if(Te(u))return;let{editor:m,inEdit:f}=o(l),h=f&&m?m.getValue():await t.vault.read(l);if(!h||ve(h)||!/^#{1,6}\s+My\s+(Task|Project|Goal)\s*$/im.test(h)||Me(l)||n.has(l.path))return;let y=[{heading:"My Task",flag:"_task_sync_state"},{heading:"My Project",flag:"_project_sync_state"},{heading:"My Goal",flag:"_goal_sync_state"}];for(let w of y){let b=pt(h,w.heading);if(!b)continue;let v=mt(h,b);if(!v)continue;let x=typeof u.done=="boolean"?u.done:null,E=typeof u[w.flag]=="boolean"?u[w.flag]:null,C=v.checked;if(E===null){await r(l,{done:!!C,[w.flag]:!!C});return}let Wt=x!==null&&x!==E;if(C!==E){await r(l,{done:!!C,[w.flag]:!!C});return}if(Wt){let Bt=ft(v.line,!!x);await s(l,h,v.absStart,v.absEnd,Bt),await r(l,{[w.flag]:!!x});return}return}},150);t.workspace.on("file-open",()=>i()),t.workspace.on("active-leaf-change",()=>i()),t.workspace.on("layout-change",()=>i()),t.workspace.on("editor-change",()=>i()),t.metadataCache.on("changed",()=>i()),t.metadataCache.on("resolved",()=>i()),t.vault.on("modify",()=>i()),t.vault.on("rename",()=>i()),t.vault.on("create",()=>i())}async function yt(t,e){let a=(t.metadataCache.getFileCache(e)??{}).frontmatter??{},o=!(typeof a.done=="boolean"&&a.done);await t.fileManager.processFrontMatter(e,c=>{c.done=o});let r=await t.vault.read(e),s=["My Task","My Project","My Goal"];for(let c of s){let i=pt(r,c);if(!i)continue;let l=mt(r,i);if(!l)continue;let d=ft(l.line,o),u=r.slice(0,l.absStart)+d+r.slice(l.absEnd);u!==r&&await t.vault.modify(e,u);break}}var bt=require("obsidian");function Ae(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Fe(t,e){let n=null;return(...a)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>{n=null,t(...a)},e)}}function Se(t){return/(^|\/)(templates?|Templates?)(\/|$)/.test(t)}function De(t){return/<%[\s\S]*?%>/.test(t)}function Pe(t,e=1500){let n=t?.stat?.ctime??0;return Date.now()-n<e}function $e(t,e,n,a){return/(^|\/)(_?templates?|Templates)(\/|$)/.test(t)||/^habit template(\.md)?$/i.test(e)?!1:!!(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(e)||a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(n))}function Ee(t,e){let n=e.map(Ae).join("|"),o=new RegExp(`^#{1,6}\\s+(?:.*?\\s)?(?:${n})\\s*$`,"gim").exec(t);if(!o)return null;let r=o.index+o[0].length,s=(o[0].match(/^#+/)||["#"])[0].length,c=new RegExp(`^#{1,${s}}\\s+`,"gim");c.lastIndex=r;let i=c.exec(t);return{start:r,end:i?i.index:t.length}}var wt=/^[ \t>]*[-*]\s+\[( |x|X)\]\s.*$/gmi;function Ce(t,e){let n=t.slice(e.start,e.end);wt.lastIndex=0;let a=wt.exec(n);if(!a)return null;let o=e.start+a.index,r=o+a[0].length,s=/\[(x|X)\]/.test(a[0]);return{absStart:o,absEnd:r,line:a[0],checked:s}}function Le(t,e){return t.replace(/\[(?: |x|X)\]/,e?"[x]":"[ ]")}function xt(t,e){let n=new Set,a=i=>{let l=t.workspace.getActiveViewOfType(bt.MarkdownView),u=!!l&&l.file?.path===i.path&&l?.getMode()!=="preview";return{editor:l?.editor,inEdit:u}},o=async(i,l)=>{n.add(i.path);try{await t.fileManager.processFrontMatter(i,d=>{for(let u of Object.keys(l))d[u]=l[u]})}finally{n.delete(i.path)}},r=async(i,l,d,u,m)=>{let{editor:f,inEdit:h}=a(i);n.add(i.path);try{if(h&&f){let p=f.offsetToPos(d),y=f.offsetToPos(u);await new Promise(requestAnimationFrame),f.replaceRange(m,p,y)}else{let p=l.slice(0,d)+m+l.slice(u);p!==l&&await t.vault.modify(i,p)}}finally{n.delete(i.path)}},c=Fe(async()=>{let i=t.workspace.getActiveFile();if(!i||e?.(i)||Se(i.path)||Pe(i)||n.has(i.path))return;let d=(t.metadataCache.getFileCache(i)??{}).frontmatter??{},{editor:u,inEdit:m}=a(i),f=m&&u?u.getValue():await t.vault.read(i);if(!f||De(f)||!$e(i.path,i.basename,f,d))return;let h=Ee(f,["\u270D\uFE0F Log","Log"]);if(!h)return;let p=Ce(f,h),y=typeof d.done=="boolean"?d.done:null,w=typeof d._habit_sync_state=="boolean"?d._habit_sync_state:null;if(!p&&y===null)return;if(w===null){p?await o(i,{done:!!p.checked,_habit_sync_state:!!p.checked}):y!==null&&await o(i,{_habit_sync_state:!!y});return}let b=p?p.checked:null,v=y!==null&&y!==w;if(b!==null&&b!==w){await o(i,{done:!!b,_habit_sync_state:!!b});return}if(v&&p){let E=Le(p.line,!!y);await r(i,f,p.absStart,p.absEnd,E),await o(i,{_habit_sync_state:!!y});return}},150);t.workspace.on("file-open",()=>c()),t.workspace.on("active-leaf-change",()=>c()),t.workspace.on("layout-change",()=>c()),t.workspace.on("editor-change",()=>c()),t.metadataCache.on("changed",()=>c()),t.metadataCache.on("resolved",()=>c()),t.vault.on("modify",()=>c()),t.vault.on("rename",()=>c()),t.vault.on("create",()=>c())}var M=require("obsidian");var vt={area:"\u{1F331}Area - ",wish:"\u2728Wish - ",goal:"\u{1F3AF}Goal - ",project:"\u{1F680}Project - ",task:"\u{1F4CC}Task - ",habit:"\u{1F504}Habit - "},Oe="03 SaveBox/Templates";function Q(t){return t.replace(/[\\/:*?"<>|]/g,"").trim()}function Mt(t){return t.trim().split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function W(t){return String(t).padStart(2,"0")}function Ye(t){let e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()));e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let n=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e.getTime()-n.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),week:a}}async function At(t,e){let n=(0,M.normalizePath)(e).split("/"),a="";for(let o of n){a=a?`${a}/${o}`:o;try{await t.vault.createFolder(a)}catch{}}}function D(t,e){let n=t.vault.getAbstractFileByPath((0,M.normalizePath)(e));return n instanceof M.TFile?n:null}function je(t,e){let n=new Date;switch(t){case"daily":return`02 Execution/1 Daily/${`${n.getFullYear()}-${W(n.getMonth()+1)}-${W(n.getDate())}.md`}`;case"weekly":{let{isoYear:a,week:o}=Ye(n);return`02 Execution/2 Weekly/${`${a}-W${W(o)}.md`}`}case"monthly":return`02 Execution/3 Monthly/${`${n.getFullYear()}-${W(n.getMonth()+1)}.md`}`;case"quarterly":{let a=Math.floor(n.getMonth()/3)+1;return`02 Execution/4 Quarterly/${`${n.getFullYear()}-Q${a}.md`}`}case"yearly":return`02 Execution/5 Yearly/${`${n.getFullYear()}.md`}`;case"note":return`03 SaveBox/Active/${Q(e)}.md`;default:return`03 SaveBox/Active/${vt[t]}${Q(e)}.md`}}async function kt(t,e){let n=`${e.charAt(0).toUpperCase()}${e.slice(1)} Template.md`,a=(0,M.normalizePath)(`${Oe}/${n}`),o=t.vault.getAbstractFileByPath(a);return o instanceof M.TFile?t.vault.read(o):""}async function _e(t,e,n){let a=(0,M.normalizePath)(e),o=a.replace(/\/[^/]+$/,""),r=a.split("/").pop();await At(t,o);let s=D(t,a);if(s)return s;let c=t.vault.getFiles().find(l=>l.name===r);if(c&&c.path!==a){await t.fileManager.renameFile(c,a);let l=D(t,a);if(l){if(!(await t.vault.read(l)).trim()){let u=await kt(t,n);u&&await t.vault.modify(l,u)}return l}}let i=await kt(t,n);return await t.vault.create(a,i??"")}async function Tt(t,e,n){if(!["task","project","goal","area","wish","habit"].includes(n))return e;let a=vt[n],o=e.path.startsWith("03 SaveBox/Active/"),r=e.basename.startsWith(a);if(!o||r)return e;let s=e.basename.replace(/^\p{Extended_Pictographic}?\s*[A-Za-z]+\s*-\s*/u,"").trim(),c=Mt(s||"Untitled"),i=(0,M.normalizePath)(`03 SaveBox/Active/${a}${Q(c)}.md`);if(i===e.path)return e;let l=D(t,i);return l||(await t.fileManager.renameFile(e,i),D(t,i)??e)}function Re(t){return t==="task"?"My Task":t==="project"?"My Project":"My Goal"}async function He(t,e,n){for(let r=0;r<25&&!t.metadataCache.getFileCache(e)?.headings?.length;r++)await new Promise(c=>setTimeout(c,40));let a=e.basename,o=Re(n);await rt(t,e,o,a)}async function S(t,e,n){let a=["daily","weekly","monthly","quarterly","yearly"].includes(e),o=(0,M.normalizePath)(je(e,n));if(a){let u=await _e(t,o,e);return await t.workspace.getLeaf(!1).openFile(u),u}let r=["task","project","goal","area","wish","habit"].includes(e)?Mt(n):n,s=D(t,o);if(s){let u=await Tt(t,s,e);return await t.workspace.getLeaf(!1).openFile(u),u}let c=await ct(t,{kind:e,title:r}),i=o.replace(/\/[^/]+$/,"");await At(t,i),c.path!==o&&await t.fileManager.renameFile(c,o);let l=D(t,o)??c;["task","project","goal"].includes(e)&&await He(t,l,e);let d=await Tt(t,l,e);return await t.workspace.getLeaf(!1).openFile(d),d}var Ft=(t,e)=>S(t,"task",e),St=(t,e)=>S(t,"project",e),Dt=(t,e)=>S(t,"goal",e);var Y=t=>S(t,"daily",""),V=t=>S(t,"weekly",""),Z=t=>S(t,"monthly",""),J=t=>S(t,"quarterly",""),tt=t=>S(t,"yearly","");var Ie=window.moment,et=new Set,We={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},nt={};for(let[t,e]of Object.entries(We))for(let n of e)nt[n.toLowerCase()]=t;var Be=Object.keys(nt).sort((t,e)=>e.length-t.length).join("|"),Ne=new RegExp(`\\b(?:${Be})\\b`,"gi");function Ke(t){let n=/^#{1,6}\s*.*\blog\b.*$/mi.exec(t);if(!n)return null;let a=n[0],o=n.index+a.length;return t[o]==="\r"&&t[o+1]===`
`?o+2:t[o]===`
`?o+1:o}function Ge(t,e){let n=Ke(t);if(n===null)return t.replace(/\s*$/,"")+`

### \u270D\uFE0F Log

${e}
`;let a=t.slice(0,n),r=t.slice(n).replace(/^\r?\n{0,}/,""),s=a.endsWith(`

`)?"":a.endsWith(`
`)?`
`:`

`;return a+s+e+`
`+r}function Pt(t,e){let n=t.path;if(/(^|\/)(_?templates?|Templates)(\/|$)/.test(n)||/^habit template(\.md)?$/i.test(t.basename))return!1;if(/^(?:\p{Emoji_Presentation}|\p{Extended_Pictographic})?\s*Habit\s*-\s*/iu.test(t.basename))return!0;if(e){let a=e.match(/^---\r?\n([\s\S]*?)\r?\n---/);if(a&&/(^|\n)\s*type\s*:\s*habit\s*($|\n)/i.test(a[1]))return!0}return!1}function qe(t){let e=t.match(Ne);return e?[...new Set(e.map(n=>nt[n.toLowerCase()]).filter(Boolean))]:[]}function Ue(t){let e=qe(t);if(e.length===0)return!0;let n=Ie().format("dddd");return e.includes(n)}function ze(t){let e=t.match(/^[\s\S]*?\bHabit\s*-\s*(.+)$/i);return e?e[1].trim():t.trim()}async function $t(t,e,n){let a=window.moment().format("YYYY-MM-DD"),o=`^${a}`;if(n.includes(o))return!1;let s=`- [ ] \u{1F504}Habit - ${ze(e.basename)} ${a} ${o}`,c=Ge(n,s);return await t.vault.modify(e,c),!0}async function j(t,e){let n=e.path;if(!et.has(n)){et.add(n);try{if(!Pt(e))return;if(!Ue(e.basename)){console.info("[MMOS] autolog: skip (weekly, not today)",{file:e.path});return}let a=await t.vault.read(e);if(!Pt(e,a))return;await $t(t,e,a)}finally{setTimeout(()=>et.delete(n),120)}}}async function Et(t,e){let n=await t.vault.read(e);await $t(t,e,n)}var Xe=window.moment,Qe="03 SaveBox/Active",Ve=/(^| )Habit -|^🔁Habit -/i,Ze={Monday:["monday","mon","senin","sen"],Tuesday:["tuesday","tue","tues","selasa","sel"],Wednesday:["wednesday","wed","rabu","rab"],Thursday:["thursday","thu","thur","thurs","kamis","kam"],Friday:["friday","fri","jumat","jum'at","jum"],Saturday:["saturday","sat","sabtu","sab"],Sunday:["sunday","sun","minggu","ming","ahad","ahd"]},at={};for(let[t,e]of Object.entries(Ze))for(let n of e)at[n.toLowerCase()]=t;var Je=Object.keys(at).sort((t,e)=>e.length-t.length).join("|"),tn=new RegExp(`\\b(?:${Je})\\b`,"gi");function en(t){let e=t.match(tn);return e?[...new Set(e.map(n=>at[n.toLowerCase()]).filter(Boolean))]:[]}function nn(t){let e=Xe().format("dddd"),n=en(t);return{ok:n.length>0&&n.includes(e),todayName:e}}async function Ct(t,e=Qe){let n=t.vault.getMarkdownFiles().filter(a=>a.path.startsWith(e+"/")).filter(a=>Ve.test(a.basename));for(let a of n){let{ok:o}=nn(a.basename);if(o)try{await j(t,a)}catch{}}}var B=require("obsidian"),A=window.moment,an=t=>A(t).format("YYYY-MM-DD");function Lt(t){let e=A(t+"-01","YYYY-MM-DD").startOf("month"),n=e.clone().endOf("month");return{start:e,end:n}}function on(t){return String(t).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function rn(t,e){let a=new RegExp(`^#{1,6}\\s+${on(e)}\\s*$`,"gim").exec(t);if(!a)return null;let o=a.index+a[0].length,r=(a[0].match(/^#+/)||["#"])[0].length,s=new RegExp(`^#{1,${r}}\\s+`,"gim");s.lastIndex=o;let c=s.exec(t);return{start:o,end:c?c.index:t.length}}function sn(t){t=String(t).trim();let e=t.match(/(\d{4}-\d{2}-\d{2})(?:\s*\^\d{4}-\d{2}-\d{2})?\s*$/)||t.match(/due\((\d{4}-\d{2}-\d{2})\)/i)||t.match(/due::\s*(\d{4}-\d{2}-\d{2})/i)||t.match(/📅\s*(\d{4}-\d{2}-\d{2})/);return e?e[1]:null}async function cn(t,e){let n=t.vault.getAbstractFileByPath(e.sourcePath);return n instanceof B.TFile?t.vault.read(n):""}function ln(t){let e=rn(t,"\u270D\uFE0F Log")||{start:0,end:t.length},n=t.slice(e.start,e.end),a=/^[ \t>]*[-*]\s+\[( |x|X)\]\s+(.*)$/gm,o=[],r;for(;r=a.exec(n);){let s=r[1].toLowerCase()==="x",c=r[2],i=sn(c);i&&o.push({date:i,done:s})}return o}function dn(t){let e=new Map;for(let n of t)e.set(n.date,e.get(n.date)||!1||n.done);return e}function un(t){let e={};for(let[a,o]of t){let r=A(a).format("YYYY-MM");(e[r]||(e[r]=[])).push({date:a,done:o})}return Object.keys(e).sort().slice(-3).reverse().map(a=>{let o=e[a],r=o.length?Math.round(o.filter(s=>s.done).length/o.length*100):0;return{label:A(a,"YYYY-MM").format("MMM"),pct:r}})}function hn(t,e=90){let n=0,a=A();for(let o=0;o<e;o++){let r=an(a);if(t.get(r))n++;else break;a.subtract(1,"day")}return n}function pn(t,e,n){let a=t.createDiv({cls:"habit-monthly-summary"});a.createEl("p").innerHTML=`<strong>\u{1F525} Current streak: ${n} day${n===1?"":"s"}</strong>`;let o=a.createDiv({cls:"month-bars"});e.forEach(({label:r,pct:s},c)=>{let i=o.createDiv({cls:"month-row"});i.innerHTML=`
      <div class="month-label">${r}</div>
      <div class="bar-track">
        <div class="bar-fill ${c===0?"bar-orange":"bar-purple"}" style="width:${s}%;"></div>
      </div>
      <div class="pct-text">${s}<span class="pct-symbol">%</span></div>
    `})}function Ot(t,e,n,a){let o=h=>A(h).format("YYYY-MM-DD"),r=n.clone().startOf("isoWeek"),s=a.clone().endOf("isoWeek"),c=[...e.keys()].sort(),i=null;for(let h=c.length-1;h>=0;h--){let p=c[h];if(!A(p).isAfter(a)){if(A(p).isBefore(n))break;if(e.get(p)){i=p;break}}}let l=t.createDiv({cls:"weekly-streak-wrap"}),d=l.createDiv({cls:"weekly-streak-head"});["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(h=>d.createDiv({cls:"head",text:h}));let u=l.createDiv({cls:"weekly-streak-grid"}),m=[],f=s.clone().endOf("isoWeek");for(;f.isSameOrAfter(r);){let h=f.clone().startOf("isoWeek");m.push({weekStart:h.clone(),weekEnd:f.clone()}),f.subtract(1,"week")}for(let h of m){let p=h.weekStart.clone();for(let y=0;y<7;y++){let w=o(p),b=p.isSameOrAfter(n)&&p.isSameOrBefore(a),v=b?!!e.get(w):!1,x=u.createDiv({cls:"weekly-streak-cell"});b||x.classList.add("pad"),v&&b&&(x.classList.add("hit"),w===i&&x.classList.add("latest-hit")),x.createDiv({cls:"num",text:b?p.format("D"):""}),x.createDiv({cls:"mmm",text:b?p.format("MMM"):""}),x.setAttr("title",b?`${p.format("ddd, DD MMM YYYY")} ${v?"\u2705 Done":"\u274C Missed"}`:""),p.add(1,"day")}}}function mn(t,e,n){let a=t.createDiv({cls:"month-switch"});return e.forEach((o,r)=>{let s=a.createEl("button",{text:o.label,cls:"month-btn"});r===0&&s.classList.add("active"),s.addEventListener("click",()=>{a.querySelectorAll(".month-btn").forEach(c=>c.classList.remove("active")),s.classList.add("active"),n(o.key)})}),a}function fn(t){let e=document.createElement("style");e.textContent=`
.habit-monthly-summary { margin:.75rem 0 1rem; }
.month-bars { display:flex; flex-direction:column; gap:10px; max-width:560px; }
.month-row { display:flex; align-items:center; gap:12px; width:100%; }
.month-label { width: 4ch; text-align: right; font-weight: 600; font-size: .95em; white-space: nowrap; }
.month-switch { display:flex; gap:8px; margin:.5rem 0 .35rem; }
.month-btn { font-size:.85em; padding:4px 8px; border-radius:8px; cursor:pointer; background: var(--background-modifier-border); border: none; }
.month-btn.active { background: var(--interactive-accent); color: white; }
.bar-track { position:relative; flex:1; height:14px; border-radius:10px; overflow:hidden; background: color-mix(in srgb, var(--background-modifier-border) 35%, transparent); }
.bar-fill { position:absolute; top:0; left:0; bottom:0; border-radius:10px; background: var(--interactive-accent); }
.bar-fill.bar-orange { background:#f4b56a; }
.pct-text { display:flex; align-items:baseline; gap:1px; font-weight:600; font-size:1.05em; white-space:nowrap; }
.pct-symbol { font-size:.8em; line-height:1; }
.weekly-streak-wrap { margin-top:.25rem; }
.weekly-streak-head { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; margin-bottom:6px; }
.weekly-streak-head .head { text-align:center; font-size:.75em; color: var(--text-faint); }
.weekly-streak-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; max-width:520px; }
.weekly-streak-cell { aspect-ratio:1/1; border-radius:10px; background: var(--background-modifier-border); display:flex; flex-direction:column; align-items:center; justify-content:center; padding-top:4px; }
.weekly-streak-cell .num { font-weight:700; font-size:.95em; color: var(--text-muted); line-height:1.1; }
.weekly-streak-cell .mmm { font-size:.7em; color: var(--text-faint); line-height:1.1; margin-top:2px; }
.weekly-streak-cell.hit { background: var(--interactive-accent); }
.weekly-streak-cell.hit .num, .weekly-streak-cell.hit .mmm { color:white; }
.weekly-streak-cell.latest-hit { background:#f4b56a !important; }
.weekly-streak-cell.latest-hit .num, .weekly-streak-cell.latest-hit .mmm { color:white; }
.weekly-streak-cell.pad { opacity:.35; }
`,t.appendChild(e)}async function Yt(t,e,n){e.replaceChildren();let a=await cn(t,n),o=ln(a),r=dn(o),s=un(r),c=hn(r);fn(e),pn(e,s,c);let l=Array.from(new Set([...r.keys()].map(u=>A(u).format("YYYY-MM")))).sort().slice(-3).reverse().map(u=>({key:u,label:A(u,"YYYY-MM").format("MMM")})),d=l[0]?.key;if(mn(e,l,u=>{d=u,e.querySelectorAll(".weekly-streak-wrap").forEach(h=>h.remove());let{start:m,end:f}=Lt(u);Ot(e,r,m,f)}),d){let{start:u,end:m}=Lt(d);Ot(e,r,u,m)}}function gn(t,e,n){let a=(()=>{let r=null;return()=>{r&&window.clearTimeout(r),r=window.setTimeout(async()=>{r=null,await Yt(t.app,e,n)},120)}})();class o extends B.MarkdownRenderChild{onload(){this.registerEvent(t.app.vault.on("modify",s=>{s?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("changed",s=>{s?.path===n.sourcePath&&a()})),this.registerEvent(t.app.metadataCache.on("resolved",()=>a())),this.registerEvent(t.app.workspace.on("editor-change",()=>a()))}}n.addChild(new o(e))}function jt(t){let e=async(n,a,o)=>{await Yt(t.app,a,o),gn(t,a,o)};t.registerMarkdownCodeBlockProcessor("wishmap-habit-monthly",e),t.registerMarkdownCodeBlockProcessor("mindmapos-habit-monthly",e)}var N=require("obsidian");var ot=class extends N.SuggestModal{constructor(n){super(n.app);this.plugin=n;this.setPlaceholder("Search or open a periodic note\u2026")}getSuggestions(n){let a=[{label:"Open Today (Daily)",action:async()=>{await Y(this.app)}},{label:"Open This Week (Weekly)",action:async()=>{await V(this.app)}},{label:"Open This Month (Monthly)",action:async()=>{await Z(this.app)}},{label:"Open This Quarter",action:async()=>{await J(this.app)}},{label:"Open This Year",action:async()=>{await tt(this.app)}}],o=n.trim().toLowerCase();return o?a.filter(r=>r.label.toLowerCase().includes(o)):a}renderSuggestion(n,a){a.createDiv({text:n.label})}async onChooseSuggestion(n){await n.action()}};function _t(t){t.addRibbonIcon("calendar-clock","WishMap: Periodic Notes",n=>{let a=new N.Menu;a.addItem(o=>o.setTitle("Open Today (Daily)").onClick(async()=>{await Y(t.app)})),a.addItem(o=>o.setTitle("Open This Week (Weekly)").onClick(async()=>{await V(t.app)})),a.addItem(o=>o.setTitle("Open This Month (Monthly)").onClick(async()=>{await Z(t.app)})),a.addItem(o=>o.setTitle("Open This Quarter").onClick(async()=>{await J(t.app)})),a.addItem(o=>o.setTitle("Open This Year").onClick(async()=>{await tt(t.app)})),a.showAtMouseEvent(n)}).setAttr("aria-label","WishMap: Periodic Notes"),t.addCommand({id:"wishmap-open-periodic-notes",name:"Open Periodic Note\u2026",callback:()=>new ot(t).open()})}var it=require("obsidian");function $(t,e){return/^(task)(\s|-)/i.test(e.basename)}function P(t,e){return/^(project)(\s|-)/i.test(e.basename)}function Rt(t,e){let n=t.vault.getAbstractFileByPath(e);return n instanceof it.TFile&&n.extension==="md"?n:null}function Ht(t,e){let n=t.metadataCache.getFileCache(e),a=new Map,o=[...n?.links??[],...n?.embeds??[]];for(let r of o){let s=t.metadataCache.getFirstLinkpathDest(r.link,e.path);s instanceof it.TFile&&s.extension==="md"&&a.set(s.path,s)}return[...a.values()]}function _(t,e){let n=new Map;for(let o of Ht(t,e))P(t,o)&&n.set(o.path,o);let a=t.metadataCache.resolvedLinks;if(a)for(let[o,r]of Object.entries(a)){if(!r||!Object.prototype.hasOwnProperty.call(r,e.path))continue;let s=Rt(t,o);s&&P(t,s)&&n.set(s.path,s)}return P(t,e)&&n.set(e.path,e),[...n.values()]}function yn(t,e){let n=new Map;for(let o of Ht(t,e))n.set(o.path,o);let a=t.metadataCache.resolvedLinks;if(a){for(let[o,r]of Object.entries(a))if(r&&Object.prototype.hasOwnProperty.call(r,e.path)){let s=Rt(t,o);s&&n.set(s.path,s)}}return n.delete(e.path),[...n.values()]}function wn(t){if(typeof t=="number")return t;if(typeof t=="string"){let e=parseFloat(t.trim());return Number.isFinite(e)?e:NaN}return NaN}function bn(t,e){let n=0;for(let a of e){if(!$(t,a))continue;let o=t.metadataCache.getFileCache(a)?.frontmatter;if(!o)continue;let r=wn(o.duration_hours);!isNaN(r)&&r>0&&(n+=r)}return Math.round(n*100)/100}async function K(t,e){let n=yn(t,e),a=bn(t,n);await t.fileManager.processFrontMatter(e,o=>{a>0?o.duration_hours=a:Object.prototype.hasOwnProperty.call(o,"duration_hours")&&delete o.duration_hours})}async function It(t){let e=t.workspace.getActiveFile();e&&P(t,e)&&await K(t,e)}var G=class extends g.Plugin{constructor(){super(...arguments);this.initializingPaths=new Set;this.data={};this._openedDailyGuard=!1}async onload(){console.log("WishMap v0.2 loaded"),await this.loadSettings();let n=new Map,a=c=>{let i=c.path,l=n.get(i);l&&window.clearTimeout(l);let d=window.setTimeout(async()=>{n.delete(i),await K(this.app,c)},300);n.set(i,d)};this.registerEvent(this.app.vault.on("create",async c=>{let i=c;!(i instanceof g.TFile)||i.extension!=="md"||window.setTimeout(async()=>{if(!$(this.app,i))return;let l=_(this.app,i);for(let d of l)a(d)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async c=>{let i=c;if(!(i instanceof g.TFile)||i.extension!=="md"||!$(this.app,i))return;let l=_(this.app,i);for(let d of l)a(d)})),this.addCommand({id:"project-rollup-duration-hours",name:"Project: Roll up duration_hours from linked tasks",callback:async()=>{await It(this.app)}}),this.addCommand({id:"create-starter-structure",name:"Create Starter Structure",callback:async()=>{await lt(this.app),new g.Notice("Starter structure created.")}}),dt(this.app),this.registerEvent(this.app.vault.on("create",async c=>{let i=c instanceof g.TFile?c:null;if(!i||i.extension!=="md")return;let d=this.app.metadataCache.getFileCache(i)?.frontmatter;(d&&(d.type==="habit"||d.category==="habit")||/\bhabit\b/i.test(i.basename))&&await Et(this.app,i)})),this.registerEvent(this.app.workspace.on("file-open",async c=>{c&&await j(this.app,c)})),gt(this.app),xt(this.app),_t(this),jt(this),this.addCommand({id:"open-today",name:"Open Today",callback:async()=>this.createOrOpenTodayDaily()}),this.addCommand({id:"run-habit-autolog",name:"Habit: Run Autolog for Scheduled Habits",callback:async()=>{await Ct(this.app),new g.Notice("Habit autolog completed.")}}),this.addCommand({id:"toggle-first-checkbox",name:"Toggle First Checkbox",callback:async()=>{let c=this.app.workspace.getActiveFile();if(!c)return new g.Notice("No active file.");await yt(this.app,c)}}),this.addCommand({id:"habit-add-today-line",name:"Habit: Append Today Line",callback:async()=>{let c=this.app.workspace.getActiveFile();if(!c)return new g.Notice("No active file.");await j(this.app,c)}}),this.app.workspace.onLayoutReady(()=>{this.ensureTodayDailyOpenOnce()}),this.registerEvent(this.app.metadataCache.on("resolved",()=>{this.ensureTodayDailyOpenOnce()})),console.log("WishMap ready");let o=new Map,r=(c,i=300)=>{let l=c.path,d=o.get(l);d&&window.clearTimeout(d);let u=window.setTimeout(async()=>{o.delete(l),await K(this.app,c)},i);o.set(l,u)},s=(c,i=1500)=>new Promise(l=>{let d=!1,u=()=>{d||(d=!0,l())},m=this.app.metadataCache.on("changed",f=>{f?.path===c&&(this.app.metadataCache.offref(m),u())});window.setTimeout(()=>{this.app.metadataCache.offref(m),u()},i)});this.registerEvent(this.app.vault.on("create",async c=>{let i=c;!(i instanceof g.TFile)||i.extension!=="md"||window.setTimeout(async()=>{if(!$(this.app,i))return;await s(i.path,1500);let l=_(this.app,i);for(let d of l)r(d,200)},300)})),this.registerEvent(this.app.metadataCache.on("changed",async c=>{let i=c;if(!(i instanceof g.TFile)||i.extension!=="md"||!$(this.app,i))return;let l=_(this.app,i);for(let d of l)r(d,200)})),this.registerEvent(this.app.metadataCache.on("changed",async c=>{let i=c;!(i instanceof g.TFile)||i.extension!=="md"||P(this.app,i)&&r(i,200)}))}onunload(){console.log("WishMap unloaded")}async openRouted(n){switch(n.type){case"task":await Ft(this.app,n.name??"");break;case"project":await St(this.app,n.name??"");break;case"goal":await Dt(this.app,n.name??"");break;case"daily":await Y(this.app);break}}todayISO(){return window.moment().format("YYYY-MM-DD")}pathForTodayDaily(){let n=window.moment(),a=n.format("YYYY-MM-DD"),o=n.format("dddd");return`02 Execution/1 Daily/${a} ${o}.md`}async createOrOpenTodayDaily(){let n=(0,g.normalizePath)(this.pathForTodayDaily()),a=this.app.vault.getAbstractFileByPath(n);if(a instanceof g.TFile){await this.app.workspace.getLeaf(!0).openFile(a);return}let r=this.app.vault.getAbstractFileByPath("03 SaveBox/Templates/Daily Template.md"),s="";r instanceof g.TFile&&(s=await this.app.vault.read(r),s=s.replace(/{{date}}/g,this.todayISO()));let c=await this.app.vault.create(n,s);await this.app.workspace.getLeaf(!0).openFile(c),console.log("Created today\u2019s daily:",n)}async ensureTodayDailyOpenOnce(){if(this._openedDailyGuard)return;let n=this.todayISO(),a=(0,g.normalizePath)(this.pathForTodayDaily()),o=this.app.vault.getAbstractFileByPath(a);if(o instanceof g.TFile){await this.app.workspace.getLeaf(!0).openFile(o),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings();return}await this.createOrOpenTodayDaily(),this._openedDailyGuard=!0,this.data.lastDailyISO=n,await this.saveSettings()}async loadSettings(){let n=await this.loadData();this.data=n??{}}async saveSettings(){await this.saveData(this.data)}};
